<!DOCTYPE html>
<html lang="ja">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>å¤ªé™½ç³»ç¸®å°ºã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</title>

	<!-- MapLibre GL JS -->
	<script src="https://unpkg.com/maplibre-gl@5.0.0/dist/maplibre-gl.js"></script>
	<link href="https://unpkg.com/maplibre-gl@5.0.0/dist/maplibre-gl.css" rel="stylesheet" />

	<!-- Turf.js -->
	<script src="https://cdn.jsdelivr.net/npm/@turf/turf@6.5.0/turf.min.js"></script>

	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
		}

		#map {
			position: absolute;
			top: 0;
			bottom: 0;
			width: 100%;
		}

		.control-panel {
			position: absolute;
			top: 20px;
			left: 20px;
			background: white;
			padding: 20px;
			border-radius: 8px;
			box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
			z-index: 1000;
			min-width: 300px;
		}

		.control-panel h2 {
			margin-bottom: 15px;
			font-size: 18px;
			color: #333;
		}

		.input-group {
			margin-bottom: 15px;
		}

		.input-group label {
			display: block;
			margin-bottom: 5px;
			font-size: 14px;
			color: #555;
		}

		.input-group input {
			width: 100%;
			padding: 8px;
			border: 1px solid #ddd;
			border-radius: 4px;
			font-size: 14px;
		}

		.input-group input:focus {
			outline: none;
			border-color: #4CAF50;
		}

		.update-btn {
			width: 100%;
			padding: 10px;
			background-color: #4CAF50;
			color: white;
			border: none;
			border-radius: 4px;
			font-size: 16px;
			cursor: pointer;
			transition: background-color 0.3s;
		}

		.update-btn:hover {
			background-color: #45a049;
		}

		.map-selector {
			margin-bottom: 15px;
		}

		.map-selector select {
			width: 100%;
			padding: 8px;
			border: 1px solid #ddd;
			border-radius: 4px;
			font-size: 14px;
			background-color: white;
			cursor: pointer;
		}

		.map-selector select:focus {
			outline: none;
			border-color: #4CAF50;
		}

		.legend {
			position: absolute;
			bottom: 30px;
			right: 20px;
			background: white;
			padding: 15px;
			border-radius: 8px;
			box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
			z-index: 1000;
		}

		.legend h3 {
			margin-bottom: 10px;
			font-size: 14px;
			color: #333;
		}

		.legend-item {
			display: flex;
			align-items: center;
			margin-bottom: 5px;
			font-size: 12px;
		}

		.legend-color {
			width: 20px;
			height: 3px;
			margin-right: 8px;
			border-radius: 2px;
		}

		.info-text {
			font-size: 12px;
			color: #666;
			margin-top: 10px;
		}
	</style>
</head>

<body>
	<div id="map"></div>

	<div class="control-panel">
		<h2>ğŸŒ å¤ªé™½ç³»ç¸®å°ºã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h2>

		<div class="map-selector">
			<label for="mapStyle">èƒŒæ™¯åœ°å›³:</label>
			<select id="mapStyle" onchange="changeMapStyle()">
				<option value="osm">OpenStreetMap</option>
				<option value="gsi-std">åœ°ç†é™¢åœ°å›³(æ¨™æº–)</option>
				<option value="gsi-pale">åœ°ç†é™¢åœ°å›³(æ·¡è‰²)</option>
				<option value="gsi-blank">åœ°ç†é™¢åœ°å›³(ç™½åœ°å›³)</option>
				<option value="gsi-photo">åœ°ç†é™¢åœ°å›³(è¡›æ˜Ÿå†™çœŸ)</option>
			</select>
		</div>

		<div class="input-group">
			<label for="earthDiameter">åœ°çƒã®ç›´å¾„ (cm):</label>
			<input type="number" id="earthDiameter" value="1.3" step="0.1" min="0.1">
		</div>

		<div class="input-group">
			<label for="sunDiameter">å¤ªé™½ã®ç›´å¾„ (m):</label>
			<input type="number" id="sunDiameter" step="0.1" min="0.1">
		</div>

		<button class="update-btn" onclick="updateOrbits()">æç”»æ›´æ–°</button>

		<div class="info-text">
			â„¹ï¸ å¤ªé™½ãƒãƒ¼ã‚«ãƒ¼ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ä½ç½®ã‚’å¤‰æ›´ã§ãã¾ã™
		</div>
	</div>

	<div class="legend">
		<h3>å¤©ä½“ãƒ»é ˜åŸŸ</h3>
		<div class="legend-item">
			<div class="legend-color" style="background-color: #A0A0A0;"></div>
			<span>æ°´æ˜Ÿ (0.39 AU)</span>
		</div>
		<div class="legend-item">
			<div class="legend-color" style="background-color: #FFA500;"></div>
			<span>é‡‘æ˜Ÿ (0.72 AU)</span>
		</div>
		<div class="legend-item">
			<div class="legend-color" style="background-color: #4169E1;"></div>
			<span>åœ°çƒ (1.00 AU)</span>
		</div>
		<div class="legend-item">
			<div class="legend-color" style="background-color: #DC143C;"></div>
			<span>ç«æ˜Ÿ (1.52 AU)</span>
		</div>
		<div class="legend-item">
			<div class="legend-color" style="background-color: #DAA520;"></div>
			<span>æœ¨æ˜Ÿ (5.20 AU)</span>
		</div>
		<div class="legend-item">
			<div class="legend-color" style="background-color: #F4A460;"></div>
			<span>åœŸæ˜Ÿ (9.58 AU)</span>
		</div>
		<div class="legend-item">
			<div class="legend-color" style="background-color: #40E0D0;"></div>
			<span>å¤©ç‹æ˜Ÿ (19.22 AU)</span>
		</div>
		<div class="legend-item">
			<div class="legend-color" style="background-color: #1E90FF;"></div>
			<span>æµ·ç‹æ˜Ÿ (30.05 AU)</span>
		</div>
		<div class="legend-item">
			<div class="legend-color" style="background-color: #8B7355;"></div>
			<span>å†¥ç‹æ˜Ÿ (39.48 AU)</span>
		</div>
		<div class="legend-item">
			<div class="legend-color" style="background-color: #696969;"></div>
			<span>ã‚«ã‚¤ãƒ‘ãƒ¼ãƒ™ãƒ«ãƒˆ (50 AU)</span>
		</div>
		<div class="legend-item">
			<div class="legend-color" style="background-color: #2F4F4F;"></div>
			<span>ã‚ªãƒ¼ãƒ«ãƒˆã®é›²å†…ç¸ (2,000 AU)</span>
		</div>
		<div class="legend-item">
			<div class="legend-color" style="background-color: #1C1C1C;"></div>
			<span>ã‚ªãƒ¼ãƒ«ãƒˆã®é›²å¤–ç¸ (100,000 AU)</span>
		</div>
		<div class="legend-item">
			<div class="legend-color" style="background-color: #FF6347;"></div>
			<span>ãƒ—ãƒ­ã‚­ã‚·ãƒãƒ»ã‚±ãƒ³ã‚¿ã‚¦ãƒª (268,770 AU)</span>
		</div>
	</div>

	<script>
		// ========== å®šæ•°å®šç¾© ==========
		// åœ°çƒã®å®Ÿéš›ã®ç›´å¾„ï¼ˆkmï¼‰
		const EARTH_ACTUAL_DIAMETER_KM = 12742;

		// å¤ªé™½ã®å®Ÿéš›ã®ç›´å¾„ï¼ˆkmï¼‰
		const SUN_ACTUAL_DIAMETER_KM = 1392700;

		// 1å¤©æ–‡å˜ä½ï¼ˆkmï¼‰
		const AU_IN_KM = 149600000;

		// æƒ‘æ˜Ÿãƒ‡ãƒ¼ã‚¿: åå‰ã€è»Œé“åŠå¾„ï¼ˆAUï¼‰ã€å®Ÿéš›ã®ç›´å¾„ï¼ˆkmï¼‰ã€è‰²ã€ç¨®åˆ¥
		const PLANETS = [
			{ name: 'æ°´æ˜Ÿ', orbitAU: 0.39, diameterKm: 4879, color: '#A0A0A0', type: 'planet' },
			{ name: 'é‡‘æ˜Ÿ', orbitAU: 0.72, diameterKm: 12104, color: '#FFA500', type: 'planet' },
			{ name: 'åœ°çƒ', orbitAU: 1.00, diameterKm: 12742, color: '#4169E1', type: 'planet' },
			{ name: 'ç«æ˜Ÿ', orbitAU: 1.52, diameterKm: 6779, color: '#DC143C', type: 'planet' },
			{ name: 'æœ¨æ˜Ÿ', orbitAU: 5.20, diameterKm: 139820, color: '#DAA520', type: 'planet' },
			{ name: 'åœŸæ˜Ÿ', orbitAU: 9.58, diameterKm: 116460, color: '#F4A460', type: 'planet' },
			{ name: 'å¤©ç‹æ˜Ÿ', orbitAU: 19.22, diameterKm: 50724, color: '#40E0D0', type: 'planet' },
			{ name: 'æµ·ç‹æ˜Ÿ', orbitAU: 30.05, diameterKm: 49244, color: '#1E90FF', type: 'planet' },
			{ name: 'å†¥ç‹æ˜Ÿ', orbitAU: 39.48, diameterKm: 2376, color: '#8B7355', type: 'dwarf' },
			{ name: 'ã‚«ã‚¤ãƒ‘ãƒ¼ãƒ™ãƒ«ãƒˆ', orbitAU: 50, diameterKm: 0, color: '#696969', type: 'region' },
			{ name: 'ã‚ªãƒ¼ãƒ«ãƒˆã®é›²(å†…ç¸)', orbitAU: 2000, diameterKm: 0, color: '#2F4F4F', type: 'region' },
			{ name: 'ã‚ªãƒ¼ãƒ«ãƒˆã®é›²(å¤–ç¸)', orbitAU: 100000, diameterKm: 0, color: '#1C1C1C', type: 'region' },
			{ name: 'ãƒ—ãƒ­ã‚­ã‚·ãƒãƒ»ã‚±ãƒ³ã‚¿ã‚¦ãƒª', orbitAU: 268770, diameterKm: 0, color: '#FF6347', type: 'star' }
		];

		// åˆæœŸä¸­å¿ƒåº§æ¨™: å’Œæ­Œå±±çœŒ å››å­£ã®éƒ·å…¬åœ’
		const INITIAL_CENTER = [135.2597718, 34.2161407]; // [çµŒåº¦, ç·¯åº¦]

		// ========== ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•° ==========
		let map;
		let sunMarker;
		let sunCoordinates = INITIAL_CENTER;

		// åœ°å›³ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©
		const MAP_STYLES = {
			'osm': {
				version: 8,
				glyphs: 'https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf',
				sources: {
					'osm': {
						type: 'raster',
						tiles: [
							'https://a.tile.openstreetmap.org/{z}/{x}/{y}.png',
							'https://b.tile.openstreetmap.org/{z}/{x}/{y}.png',
							'https://c.tile.openstreetmap.org/{z}/{x}/{y}.png'
						],
						tileSize: 256,
						attribution: 'Â© OpenStreetMap contributors'
					}
				},
				layers: [{
					id: 'osm',
					type: 'raster',
					source: 'osm',
					minzoom: 0,
					maxzoom: 19
				}]
			},
			'gsi-std': {
				version: 8,
				glyphs: 'https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf',
				sources: {
					'gsi-std': {
						type: 'raster',
						tiles: [
							'https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png'
						],
						tileSize: 256,
						attribution: '<a href="https://maps.gsi.go.jp/development/ichiran.html" target="_blank">åœ°ç†é™¢ã‚¿ã‚¤ãƒ«</a>'
					}
				},
				layers: [{
					id: 'gsi-std',
					type: 'raster',
					source: 'gsi-std',
					minzoom: 0,
					maxzoom: 18
				}]
			},
			'gsi-pale': {
				version: 8,
				glyphs: 'https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf',
				sources: {
					'gsi-pale': {
						type: 'raster',
						tiles: [
							'https://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png'
						],
						tileSize: 256,
						attribution: '<a href="https://maps.gsi.go.jp/development/ichiran.html" target="_blank">åœ°ç†é™¢ã‚¿ã‚¤ãƒ«</a>'
					}
				},
				layers: [{
					id: 'gsi-pale',
					type: 'raster',
					source: 'gsi-pale',
					minzoom: 0,
					maxzoom: 18
				}]
			},
			'gsi-blank': {
				version: 8,
				glyphs: 'https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf',
				sources: {
					'gsi-blank': {
						type: 'raster',
						tiles: [
							'https://cyberjapandata.gsi.go.jp/xyz/blank/{z}/{x}/{y}.png'
						],
						tileSize: 256,
						attribution: '<a href="https://maps.gsi.go.jp/development/ichiran.html" target="_blank">åœ°ç†é™¢ã‚¿ã‚¤ãƒ«</a>'
					}
				},
				layers: [{
					id: 'gsi-blank-layer',
					type: 'raster',
					source: 'gsi-blank',
					minzoom: 0,
					maxzoom: 14
				}]
			},
			'gsi-photo': {
				version: 8,
				glyphs: 'https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf',
				sources: {
					'gsi-photo': {
						type: 'raster',
						tiles: [
							'https://cyberjapandata.gsi.go.jp/xyz/seamlessphoto/{z}/{x}/{y}.jpg'
						],
						tileSize: 256,
						attribution: '<a href="https://maps.gsi.go.jp/development/ichiran.html" target="_blank">åœ°ç†é™¢ã‚¿ã‚¤ãƒ«</a>'
					}
				},
				layers: [{
					id: 'gsi-photo',
					type: 'raster',
					source: 'gsi-photo',
					minzoom: 0,
					maxzoom: 18
				}]
			}
		};

		// ========== åˆæœŸåŒ– ==========
		function init() {
			// åœ°å›³ã®åˆæœŸåŒ–
			map = new maplibregl.Map({
				container: 'map',
				style: MAP_STYLES['osm'],
				center: INITIAL_CENTER,
				zoom: 14
			});			// åœ°å›³ã®èª­ã¿è¾¼ã¿å®Œäº†å¾Œ
			map.on('load', () => {
				// å¤ªé™½ãƒãƒ¼ã‚«ãƒ¼ã®ä½œæˆ
				createSunMarker();

				// åˆæœŸå€¤ã§å¤ªé™½ã®ç›´å¾„ã‚’è¨ˆç®—
				updateSunDiameter();

				// åˆæœŸæç”»
				updateOrbits();
			});

			// åœ°çƒã®ç›´å¾„å…¥åŠ›æ™‚ã«å¤ªé™½ã®ç›´å¾„ã‚’è‡ªå‹•è¨ˆç®—
			document.getElementById('earthDiameter').addEventListener('input', updateSunDiameter);

			// å¤ªé™½ã®ç›´å¾„å…¥åŠ›æ™‚ã«åœ°çƒã®ç›´å¾„ã‚’è‡ªå‹•è¨ˆç®—
			document.getElementById('sunDiameter').addEventListener('input', updateEarthDiameter);

			// Enterã‚­ãƒ¼ã§æç”»æ›´æ–°
			document.getElementById('earthDiameter').addEventListener('keypress', (e) => {
				if (e.key === 'Enter') updateOrbits();
			});
			document.getElementById('sunDiameter').addEventListener('keypress', (e) => {
				if (e.key === 'Enter') updateOrbits();
			});
		}

		// ========== å¤ªé™½ãƒãƒ¼ã‚«ãƒ¼ã®ä½œæˆ ==========
		function createSunMarker() {
			// ã‚«ã‚¹ã‚¿ãƒ ãƒãƒ¼ã‚«ãƒ¼è¦ç´ ã®ä½œæˆ
			const el = document.createElement('div');
			el.style.width = '30px';
			el.style.height = '30px';
			el.style.borderRadius = '50%';
			el.style.background = 'radial-gradient(circle, #FFD700, #FFA500)';
			el.style.border = '3px solid white';
			el.style.boxShadow = '0 0 15px rgba(255, 165, 0, 0.7)';
			el.style.cursor = 'move';

			// ãƒãƒ¼ã‚«ãƒ¼ã®ä½œæˆ
			sunMarker = new maplibregl.Marker({
				element: el,
				draggable: true
			})
				.setLngLat(sunCoordinates)
				.addTo(map);

			// ãƒ‰ãƒ©ãƒƒã‚°çµ‚äº†æ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆ
			sunMarker.on('dragend', () => {
				sunCoordinates = sunMarker.getLngLat().toArray();
				updateOrbits();
			});
		}

		// ========== åœ°çƒã®ç›´å¾„ã‹ã‚‰å¤ªé™½ã®ç›´å¾„ã‚’è¨ˆç®— ==========
		function updateSunDiameter() {
			const earthDiameterCm = parseFloat(document.getElementById('earthDiameter').value);
			if (isNaN(earthDiameterCm) || earthDiameterCm <= 0) return;

			// ç¸®å°ºä¿‚æ•°ã®è¨ˆç®—
			// Scale = å…¥åŠ›ã•ã‚ŒãŸåœ°çƒã®ç›´å¾„(cm) / (åœ°çƒã®å®Ÿéš›ã®ç›´å¾„(km) * 100,000)
			const scale = earthDiameterCm / (EARTH_ACTUAL_DIAMETER_KM * 100000);

			// å¤ªé™½ã®ç¸®å°ºå¾Œã®ç›´å¾„ï¼ˆcmï¼‰
			const sunDiameterCm = SUN_ACTUAL_DIAMETER_KM * 100000 * scale;

			// ãƒ¡ãƒ¼ãƒˆãƒ«ã«å¤‰æ›
			const sunDiameterM = sunDiameterCm / 100;

			// å¤ªé™½ã®ç›´å¾„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«è¨­å®š
			document.getElementById('sunDiameter').value = sunDiameterM.toFixed(2);
		}

		// ========== å¤ªé™½ã®ç›´å¾„ã‹ã‚‰åœ°çƒã®ç›´å¾„ã‚’è¨ˆç®— ==========
		function updateEarthDiameter() {
			const sunDiameterM = parseFloat(document.getElementById('sunDiameter').value);
			if (isNaN(sunDiameterM) || sunDiameterM <= 0) return;

			// å¤ªé™½ã®ç›´å¾„ã‚’cmã«å¤‰æ›
			const sunDiameterCm = sunDiameterM * 100;

			// ç¸®å°ºä¿‚æ•°ã®è¨ˆç®—
			const scale = sunDiameterCm / (SUN_ACTUAL_DIAMETER_KM * 100000);

			// åœ°çƒã®ç¸®å°ºå¾Œã®ç›´å¾„ï¼ˆcmï¼‰
			const earthDiameterCm = EARTH_ACTUAL_DIAMETER_KM * 100000 * scale;

			// åœ°çƒã®ç›´å¾„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«è¨­å®š
			document.getElementById('earthDiameter').value = earthDiameterCm.toFixed(2);
		}

		// ========== è»Œé“ã®æ›´æ–°ãƒ»æç”» ==========
		function updateOrbits() {
			const earthDiameterCm = parseFloat(document.getElementById('earthDiameter').value);

			if (isNaN(earthDiameterCm) || earthDiameterCm <= 0) {
				alert('æœ‰åŠ¹ãªåœ°çƒã®ç›´å¾„ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
				return;
			}

			// ç¸®å°ºä¿‚æ•°ã®è¨ˆç®—
			// Scale = å…¥åŠ›ã•ã‚ŒãŸåœ°çƒã®ç›´å¾„(cm) / (åœ°çƒã®å®Ÿéš›ã®ç›´å¾„(km) * 100,000)
			const scale = earthDiameterCm / (EARTH_ACTUAL_DIAMETER_KM * 100000);

			// 1AU ãŒåœ°å›³ä¸Šã§ä½•ãƒ¡ãƒ¼ãƒˆãƒ«ã«ãªã‚‹ã‹ã‚’è¨ˆç®—
			// 1AU (km) â†’ cm ã«å¤‰æ›ã—ã¦ç¸®å°ºä¿‚æ•°ã‚’æ›ã‘ã€ãƒ¡ãƒ¼ãƒˆãƒ«ã«æˆ»ã™
			const oneAUInMeters = (AU_IN_KM * 100000 * scale) / 100;

			console.log(`ç¸®å°º: åœ°çƒ ${earthDiameterCm} cm`);
			console.log(`1AU = ${oneAUInMeters.toFixed(2)} m`);

			// æ—¢å­˜ã®è»Œé“ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤
			PLANETS.forEach(planet => {
				const orbitLayerId = `orbit-${planet.name}`;
				const orbitSourceId = `orbit-source-${planet.name}`;
				const planetLayerId = `planet-${planet.name}`;
				const planetSourceId = `planet-source-${planet.name}`;
				const labelLayerId = `label-${planet.name}`;
				const labelSourceId = `label-source-${planet.name}`;

				if (map.getLayer(orbitLayerId)) {
					map.removeLayer(orbitLayerId);
				}
				if (map.getSource(orbitSourceId)) {
					map.removeSource(orbitSourceId);
				}
				if (map.getLayer(planetLayerId)) {
					map.removeLayer(planetLayerId);
				}
				if (map.getSource(planetSourceId)) {
					map.removeSource(planetSourceId);
				}
				if (map.getLayer(labelLayerId)) {
					map.removeLayer(labelLayerId);
				}
				if (map.getSource(labelSourceId)) {
					map.removeSource(labelSourceId);
				}
			});

			// å„æƒ‘æ˜Ÿã®è»Œé“ã¨æƒ‘æ˜Ÿæœ¬ä½“ã‚’æç”»
			PLANETS.forEach(planet => {
				// è»Œé“åŠå¾„ï¼ˆãƒ¡ãƒ¼ãƒˆãƒ«ï¼‰
				const orbitRadiusMeters = planet.orbitAU * oneAUInMeters;

				// è»Œé“åŠå¾„ã‚’ã‚­ãƒ­ãƒ¡ãƒ¼ãƒˆãƒ«ã«å¤‰æ›ï¼ˆTurf.jsã¯kmã‚’ä½¿ç”¨ï¼‰
				const orbitRadiusKm = orbitRadiusMeters / 1000;

				// æƒ‘æ˜Ÿã®ç›´å¾„ï¼ˆãƒ¡ãƒ¼ãƒˆãƒ«ï¼‰ã‚’è¨ˆç®—
				const planetDiameterMeters = planet.diameterKm > 0 ? (planet.diameterKm * 100000 * scale) / 100 : 0;
				const planetRadiusKm = (planetDiameterMeters / 2) / 1000;

				// è»Œé“å††ã‚’ç”Ÿæˆ
				const orbitCircle = turf.circle(sunCoordinates, orbitRadiusKm, {
					steps: 128,
					units: 'kilometers'
				});

				// æƒ‘æ˜Ÿã®ä½ç½®ã‚’è¨ˆç®—ï¼ˆè»Œé“ä¸Šã®å³å´ã€0åº¦ã®ä½ç½®ï¼‰
				const planetPosition = turf.destination(sunCoordinates, orbitRadiusKm, 90, { units: 'kilometers' });

				// æƒ‘æ˜Ÿã®å††ã‚’ç”Ÿæˆ
				const planetCircle = turf.circle(planetPosition.geometry.coordinates, planetRadiusKm, {
					steps: 64,
					units: 'kilometers'
				});

				const orbitSourceId = `orbit-source-${planet.name}`;
				const orbitLayerId = `orbit-${planet.name}`;
				const planetSourceId = `planet-source-${planet.name}`;
				const planetLayerId = `planet-${planet.name}`;

				// è»Œé“ã®ã‚½ãƒ¼ã‚¹ã¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¿½åŠ 
				map.addSource(orbitSourceId, {
					type: 'geojson',
					data: orbitCircle
				});

				// è»Œé“ã®ç·šå¹…ã¨é€æ˜åº¦ã‚’ç¨®åˆ¥ã«ã‚ˆã£ã¦èª¿æ•´
				const lineWidth = planet.type === 'region' ? 2 : (planet.type === 'star' ? 3 : 4);
				const lineOpacity = planet.type === 'region' ? 0.3 : (planet.type === 'star' ? 0.5 : 0.6);
				const lineDasharray = planet.type === 'region' ? [5, 5] : (planet.type === 'star' ? [10, 10] : null);

				const layerPaint = {
					'line-color': planet.color,
					'line-width': lineWidth,
					'line-opacity': lineOpacity
				};
				if (lineDasharray) {
					layerPaint['line-dasharray'] = lineDasharray;
				}

				map.addLayer({
					id: orbitLayerId,
					type: 'line',
					source: orbitSourceId,
					paint: layerPaint
				});

				// æƒ‘æ˜Ÿã®ã‚½ãƒ¼ã‚¹ã¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¿½åŠ ï¼ˆå¡—ã‚Šã¤ã¶ã—å††ã¨ã—ã¦æç”»ï¼‰
				// é ˜åŸŸã‚„æ’æ˜Ÿï¼ˆç›´å¾„0ï¼‰ã¯æƒ‘æ˜Ÿæœ¬ä½“ã‚’æç”»ã—ãªã„
				if (planet.diameterKm > 0) {
					map.addSource(planetSourceId, {
						type: 'geojson',
						data: planetCircle
					});

					map.addLayer({
						id: planetLayerId,
						type: 'fill',
						source: planetSourceId,
						paint: {
							'fill-color': planet.color,
							'fill-opacity': 0.8
						}
					});
				}

				// æƒ‘æ˜Ÿãƒ©ãƒ™ãƒ«ã®è¿½åŠ 
				const labelSourceId = `label-source-${planet.name}`;
				const labelLayerId = `label-${planet.name}`;

				// ãƒ©ãƒ™ãƒ«ç”¨ã®ãƒã‚¤ãƒ³ãƒˆã‚’ä½œæˆ
				const labelPoint = turf.point(planetPosition.geometry.coordinates, {
					name: planet.name
				});

				map.addSource(labelSourceId, {
					type: 'geojson',
					data: labelPoint
				});

				// ãƒ©ãƒ™ãƒ«ã‚µã‚¤ã‚ºã‚’å¤©ä½“ã®ç¨®é¡ã«ã‚ˆã£ã¦èª¿æ•´
				const textSize = planet.type === 'star' ? 16 : (planet.type === 'region' ? 14 : 20);

				map.addLayer({
					id: labelLayerId,
					type: 'symbol',
					source: labelSourceId,
					layout: {
						'text-field': ['get', 'name'],
						'text-font': ['Open Sans Bold', 'Arial Unicode MS Bold'],
						'text-size': textSize,
						'text-offset': [0, -2.5],
						'text-anchor': 'bottom'
					},
					paint: {
						'text-color': planet.color,
						'text-halo-color': '#ffffff',
						'text-halo-width': 3
					}
				}); console.log(`${planet.name}: è»Œé“ ${orbitRadiusMeters.toFixed(2)} m, ç›´å¾„ ${planetDiameterMeters.toFixed(4)} m`);
			});
		}

		// ========== åœ°å›³ã‚¹ã‚¿ã‚¤ãƒ«åˆ‡ã‚Šæ›¿ãˆ ==========
		function changeMapStyle() {
			const selectedStyle = document.getElementById('mapStyle').value;

			// ç¾åœ¨ã®è»Œé“ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
			const orbitsData = {};
			PLANETS.forEach(planet => {
				const orbitSourceId = `orbit-source-${planet.name}`;
				const planetSourceId = `planet-source-${planet.name}`;
				const labelSourceId = `label-source-${planet.name}`;

				if (map.getSource(orbitSourceId)) {
					orbitsData[`orbit-${planet.name}`] = map.getSource(orbitSourceId)._data;
				}
				if (map.getSource(planetSourceId)) {
					orbitsData[`planet-${planet.name}`] = map.getSource(planetSourceId)._data;
				}
				if (map.getSource(labelSourceId)) {
					orbitsData[`label-${planet.name}`] = map.getSource(labelSourceId)._data;
				}
			});

			// ç¾åœ¨ã®ä¸­å¿ƒåº§æ¨™ã¨ã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«ã‚’ä¿å­˜
			const currentCenter = map.getCenter();
			const currentZoom = map.getZoom();
			const currentSunCoords = sunCoordinates;

			// åœ°å›³ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å¤‰æ›´
			map.setStyle(MAP_STYLES[selectedStyle]);

			// ã‚¹ã‚¿ã‚¤ãƒ«èª­ã¿è¾¼ã¿å®Œäº†å¾Œã«è»Œé“ã‚’å†æç”»
			map.once('styledata', () => {
				// ä¸­å¿ƒåº§æ¨™ã¨ã‚ºãƒ¼ãƒ ã‚’å¾©å…ƒ
				map.setCenter(currentCenter);
				map.setZoom(currentZoom);

				// å¤ªé™½ã®ä½ç½®ã‚’å¾©å…ƒ
				sunCoordinates = currentSunCoords;
				if (sunMarker) {
					sunMarker.setLngLat(sunCoordinates);
				}

				// è»Œé“ã‚’å†æç”»
				if (Object.keys(orbitsData).length > 0) {
					updateOrbits();
				}
			});
		}

		// ========== ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸåŒ– ==========
		window.addEventListener('load', init);
	</script>
</body>

</html>
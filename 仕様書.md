# 依頼: 太陽系縮尺シミュレーター（Solar System Map）の実装
あなたは熟練したフロントエンドエンジニアおよびGISスペシャリストです。以下の要件に基づき、MapLibre GL JSを使用した単一のHTMLファイル（HTML/CSS/JSを含む）を作成してください。

## 1. プロジェクト概要
- ユーザーが入力した「地球の大きさ（cm）」を基準に、実際の太陽系の縮尺を計算し、地図上に惑星の軌道を描画するWebアプリケーション。
- ユーザーは地図上の「太陽（中心）」を自由に動かすことができ、それに追従して軌道が再描画される。

## 2. 技術スタック
- **MapLibre GL JS** (CDNを使用): 地図表示用。
- **Turf.js** (CDNを使用): 正確な円（ポリゴン）の生成と距離計算用。
- **OpenStreetMap (Raster Tiles)**: 地図タイルとして使用（APIキー不要のため）。
- CSS/HTML5: シンプルなUI構築。

## 3. 計算ロジックと定数
- **地球の実際の直径**: 12,742 km
- **1天文単位 (AU)**: 149,600,000 km
- **縮尺係数 (Scale Factor)**:
  - `Scale = 入力された地球の直径(cm) / (12,742 * 100,000)`
  - または `入力された地球の直径` を元に、1AUが地図上で何メートルになるかを算出する。
- **惑星データ (平均軌道半径)**:
  - 水星: 0.39 AU
  - 金星: 0.72 AU
  - 地球: 1.00 AU
  - 火星: 1.52 AU
  - 木星: 5.20 AU
  - 土星: 9.58 AU
  - 天王星: 19.22 AU
  - 海王星: 30.05 AU

## 4. 機能要件
1.  **地図表示**:
    - 初期中心座標: 和歌山県 四季の郷公園 (緯度: 34.1954, 経度: 135.2675)
    - ズームレベル: 14
2.  **コントロールパネル (画面左上にオーバーレイ表示)**:
    - 入力フィールド: 「地球の直径 (cm)」 (初期値: 1.3)
    - 入力フィールド: 「太陽の直径 (m)」 (地球の直径と連動して自動計算・表示されること。逆に太陽を入力しても地球が計算される相互変換があると望ましい)
    - ボタン: 「描画更新」
3.  **インタラクション**:
    - 地図中央に「太陽」を示すドラッグ可能なマーカーを配置。
    - マーカーをドラッグ終了 (dragend) した時点で、その位置を中心として惑星軌道を再描画。
    - 入力値を変更してボタンを押すと、縮尺を変更して再描画。
4.  **描画仕様 (MapLibre)**:
    - `turf.circle` を使用して、各惑星の軌道半径を持つGeoJSONポリゴンを生成する。
    - これをMapLibreの `Source` (GeoJSONタイプ) として登録し、`Layer` (Lineタイプ) で描画する。
    - 各惑星の軌道は色分けし、凡例（Legend）またはラベルを表示するとなお良い。

## 5. 出力形式
- 必要なライブラリのCDNリンクを含んだ、実行可能な**単一のHTMLファイル**のコードブロック。
- コード内には、計算ロジックの日本語コメントを含めること。

graph TD
    %% ノードのスタイル定義
    classDef user fill:#f9f,stroke:#333,stroke-width:2px,color:black;
    classDef ui fill:#e1f5fe,stroke:#0277bd,stroke-width:2px,color:black;
    classDef logic fill:#fff9c4,stroke:#fbc02d,stroke-width:2px,color:black;
    classDef lib fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px,color:black;
    classDef data fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:black;

    %% ユーザー層
    User((ユーザー)):::user

    %% Webブラウザ（アプリケーション層）
    subgraph Browser [Webブラウザ (クライアントサイド)]
        direction TB
        
        %% UIコンポーネント
        subgraph UI_Layer [ユーザーインターフェース]
            InputParams[設定パネル<br/>(地球の直径 / 地図スタイル)]:::ui
            Interactions[地図操作<br/>(クリック / ドラッグ)]:::ui
            GeoLocBtn[現在地取得ボタン]:::ui
        end

        %% メインロジック
        subgraph Core_Logic [制御ロジック (main.js)]
            ScaleCalc[縮尺計算エンジン<br/>(updateOrbits)]:::logic
            TimeCalc[到達時間計算<br/>(calculateTravelTime)]:::logic
            EventHandler[イベントハンドラ]:::logic
        end

        %% ライブラリ層
        subgraph Libraries [外部ライブラリ]
            TurfJS[<b>Turf.js</b><br/>地理空間解析]:::lib
            MapLibre[<b>MapLibre GL JS</b><br/>地図レンダリング]:::lib
            BrowserAPI[Geolocation API<br/>位置情報]:::lib
        end
    end

    %% 外部データ層
    subgraph External [外部リソース]
        TileServer[タイルサーバー<br/>(OpenStreetMap / 地理院地図)]:::data
        PlanetData[惑星定義データ<br/>(PLANETS定数)]:::data
    end

    %% データフローと処理の流れ
    User -->|直径入力 / スタイル変更| InputParams
    User -->|移動 / 詳細表示| Interactions
    User -->|現在地要求| GeoLocBtn

    InputParams -->|値の受け渡し| ScaleCalc
    PlanetData -.->|静的データ参照| ScaleCalc
    
    GeoLocBtn -->|API呼び出し| BrowserAPI
    BrowserAPI -->|緯度経度返却| ScaleCalc

    %% 重要な計算プロセス
    ScaleCalc -- "1. 縮尺係数算出" --> ScaleCalc
    ScaleCalc -- "2. ジオメトリ生成要求<br/>(circle / ellipse)" --> TurfJS
    TurfJS -- "3. GeoJSON生成" --> MapLibre

    %% 描画プロセス
    Interactions -->|ポップアップ/移動| EventHandler
    EventHandler -->|Map操作| MapLibre
    MapLibre -- "4. タイル要求" --> TileServer
    TileServer -- "5. 画像/ベクトルデータ" --> MapLibre
    
    %% 最終出力
    MapLibre -->|地図描画 & 重畳表示| User
<!DOCTYPE html>
<html lang="ja">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>æ’æ˜Ÿã‚µã‚¤ã‚ºæ¯”è¼ƒãƒãƒƒãƒ—</title>
	<meta name="description" content="ã€Œæ’æ˜Ÿã‚µã‚¤ã‚ºæ¯”è¼ƒãƒãƒƒãƒ—ã€ã¯æ§˜ã€…ãªæ’æ˜Ÿã®å¤§ãã•ã‚’ç¸®å°ºã—ã¦åœ°å›³ä¸Šã«è¡¨ç¤ºã—ã¾ã™ã€‚å„æ’æ˜Ÿã®ç›¸å¯¾çš„ãªã‚µã‚¤ã‚ºã‚„ç‰¹å¾´ã‚’è¦–è¦šçš„ã«ç†è§£ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚">
	<meta property="og:title" content="æ’æ˜Ÿã‚µã‚¤ã‚ºæ¯”è¼ƒãƒãƒƒãƒ—">
	<meta property="og:description" content="ã€Œæ’æ˜Ÿã‚µã‚¤ã‚ºæ¯”è¼ƒãƒãƒƒãƒ—ã€ã¯æ§˜ã€…ãªæ’æ˜Ÿã®å¤§ãã•ã‚’ç¸®å°ºã—ã¦åœ°å›³ä¸Šã«è¡¨ç¤ºã—ã¾ã™ã€‚å„æ’æ˜Ÿã®ç›¸å¯¾çš„ãªã‚µã‚¤ã‚ºã‚„ç‰¹å¾´ã‚’è¦–è¦šçš„ã«ç†è§£ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚">

	<!-- Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-89GN3KL35R"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag() { dataLayer.push(arguments); }
		gtag('js', new Date());
		gtag('config', 'G-89GN3KL35R');
	</script>

	<!-- MapLibre GL JS -->
	<script src="https://unpkg.com/maplibre-gl@5.0.0/dist/maplibre-gl.js"></script>
	<link href="https://unpkg.com/maplibre-gl@5.0.0/dist/maplibre-gl.css" rel="stylesheet" />

	<!-- Turf.js -->
	<script src="https://cdn.jsdelivr.net/npm/@turf/turf@6.5.0/turf.min.js"></script>

	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
		}

		#map {
			position: absolute;
			top: 0;
			bottom: 0;
			width: 100%;
		}

		.control-panel {
			position: absolute;
			top: 20px;
			left: 20px;
			background: white;
			padding: 20px;
			border-radius: 8px;
			box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
			z-index: 1000;
			min-width: 300px;
		}

		.control-panel h2 {
			margin-bottom: 15px;
			font-size: 18px;
			color: #333;
		}

		.input-group {
			margin-bottom: 15px;
		}

		.input-group label {
			display: block;
			margin-bottom: 5px;
			font-size: 14px;
			color: #555;
		}

		.input-group input {
			width: 100%;
			padding: 8px;
			border: 1px solid #ddd;
			border-radius: 4px;
			font-size: 14px;
		}

		.input-group input:focus {
			outline: none;
			border-color: #4CAF50;
		}

		.update-btn {
			width: 100%;
			padding: 10px;
			background-color: #4CAF50;
			color: white;
			border: none;
			border-radius: 4px;
			font-size: 16px;
			cursor: pointer;
			transition: background-color 0.3s;
		}

		.update-btn:hover {
			background-color: #45a049;
		}

		.map-selector {
			margin-bottom: 15px;
		}

		.map-selector label {
			display: block;
			margin-bottom: 5px;
			font-size: 14px;
			color: #555;
		}

		.map-selector select {
			width: 100%;
			padding: 8px;
			border: 1px solid #ddd;
			border-radius: 4px;
			font-size: 14px;
			background-color: white;
			cursor: pointer;
		}

		.map-selector select:focus {
			outline: none;
			border-color: #4CAF50;
		}

		.legend {
			position: absolute;
			bottom: 30px;
			right: 20px;
			background: white;
			padding: 15px;
			border-radius: 8px;
			box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
			z-index: 1000;
			max-height: 70vh;
			overflow-y: auto;
		}

		.legend h3 {
			margin-bottom: 10px;
			font-size: 14px;
			color: #333;
		}

		.legend-category {
			margin-bottom: 10px;
		}

		.legend-category-title {
			font-size: 12px;
			font-weight: bold;
			color: #555;
			margin-bottom: 5px;
		}

		.legend-item {
			display: flex;
			align-items: center;
			margin-bottom: 5px;
			font-size: 12px;
			margin-left: 10px;
			cursor: pointer;
			user-select: none;
		}

		.legend-item:hover {
			background-color: #f0f0f0;
			border-radius: 3px;
		}

		.legend-item input[type="checkbox"] {
			margin-right: 5px;
			cursor: pointer;
		}

		.legend-color {
			width: 20px;
			height: 20px;
			margin-right: 8px;
			border-radius: 50%;
			border: 2px solid rgba(0, 0, 0, 0.2);
		}

		.info-text {
			font-size: 12px;
			color: #666;
			margin-top: 10px;
		}

		.recommended-settings {
			background: #f9f9f9;
			padding: 10px;
			border-radius: 4px;
			margin-bottom: 15px;
			font-size: 12px;
			color: #666;
		}

		.recommended-settings div {
			margin-bottom: 3px;
		}

		.out-of-range {
			position: absolute;
			top: 20px;
			right: 20px;
			background: white;
			padding: 15px;
			border-radius: 8px;
			box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
			z-index: 1000;
			max-width: 300px;
		}

		.out-of-range h3 {
			margin-bottom: 10px;
			font-size: 14px;
			color: #333;
		}

		.out-of-range-item {
			font-size: 12px;
			color: #666;
			margin-bottom: 8px;
			padding: 8px;
			border-left: 3px solid;
			padding-left: 8px;
			background: #f9f9f9;
		}

		.out-of-range-empty {
			font-size: 12px;
			color: #999;
			font-style: italic;
		}

		.panel-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 10px;
		}

		.panel-header h2,
		.panel-header h3 {
			margin-bottom: 0;
		}

		.toggle-btn {
			background: none;
			border: none;
			font-size: 18px;
			cursor: pointer;
			padding: 5px;
			color: #666;
			transition: color 0.3s;
		}

		.toggle-btn:hover {
			color: #333;
		}

		.panel-content {
			transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
			overflow: hidden;
		}

		.panel-content.collapsed {
			max-height: 0 !important;
			opacity: 0;
			margin: 0;
			padding: 0;
		}

		.fullscreen-btn,
		.location-btn {
			position: absolute;
			left: 20px;
			background: white;
			border: none;
			border-radius: 4px;
			padding: 10px 15px;
			font-size: 20px;
			cursor: pointer;
			box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
			z-index: 1000;
			transition: background-color 0.3s;
			width: 50px;
			height: 50px;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.fullscreen-btn {
			bottom: 30px;
		}

		.location-btn {
			bottom: 90px;
		}

		.fullscreen-btn:hover,
		.location-btn:hover {
			background-color: #f0f0f0;
		}

		.location-btn:disabled {
			opacity: 0.5;
			cursor: not-allowed;
		}
	</style>
</head>

<body>
	<div id="map"></div>

	<a href="index.html" class="home-link" title="ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹">ğŸ  ãƒ›ãƒ¼ãƒ </a>

	<button class="fullscreen-btn" onclick="toggleFullscreen()" title="å…¨ç”»é¢ãƒ¢ãƒ¼ãƒ‰">â›¶</button>
	<button class="location-btn" onclick="setCurrentLocation()" title="ç¾åœ¨åœ°ã‚’ä¸­å¿ƒã«ã™ã‚‹">ğŸ“</button>

	<div class="control-panel">
		<div class="panel-header">
			<h2>ğŸŒŸ æ’æ˜Ÿã‚µã‚¤ã‚ºæ¯”è¼ƒãƒãƒƒãƒ—</h2>
			<button class="toggle-btn" onclick="togglePanel('controlContent')" title="ãƒ‘ãƒãƒ«ã‚’æŠ˜ã‚ŠãŸãŸã‚€">â–¼</button>
		</div>

		<div id="controlContent" class="panel-content">
			<div class="map-selector">
				<label for="mapStyle">èƒŒæ™¯åœ°å›³:</label>
				<select id="mapStyle" onchange="changeMapStyle()">
					<option value="osm">OpenStreetMap</option>
					<option value="gsi-std">åœ°ç†é™¢åœ°å›³(æ¨™æº–)</option>
					<option value="gsi-pale">åœ°ç†é™¢åœ°å›³(æ·¡è‰²)</option>
					<option value="gsi-blank">åœ°ç†é™¢åœ°å›³(ç™½åœ°å›³)</option>
					<option value="gsi-photo">åœ°ç†é™¢åœ°å›³(è¡›æ˜Ÿå†™çœŸ)</option>
				</select>
			</div>

			<div class="input-group">
				<label for="sunDiameter">å¤ªé™½ã®ç›´å¾„ (m):</label>
				<input type="number" id="sunDiameter" value="100" step="1" min="0.1">
			</div>

			<div class="recommended-settings">
				<strong>æ¨å¥¨è¨­å®šä¾‹:</strong>
				<div>ãƒ»å°ã•ãªå…¬åœ’è¦æ¨¡: 10m</div>
				<div>ãƒ»è¡—åŒºè¦æ¨¡: 100m</div>
				<div>ãƒ»éƒ½å¸‚è¦æ¨¡: 1,000m</div>
			</div>

			<button class="update-btn" onclick="updateStars()">æç”»æ›´æ–°</button>

			<div class="info-text">
				â„¹ï¸ å¤ªé™½ãƒãƒ¼ã‚«ãƒ¼ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ä½ç½®ã‚’å¤‰æ›´ã§ãã¾ã™
			</div>
		</div>
	</div>

	<div class="out-of-range" id="outOfRange">
		<div class="panel-header">
			<h3>ğŸ“ æç”»ç¯„å›²å¤–ã®æ’æ˜Ÿ</h3>
			<button class="toggle-btn" onclick="togglePanel('outOfRangeContent')" title="ãƒ‘ãƒãƒ«ã‚’æŠ˜ã‚ŠãŸãŸã‚€">â–¼</button>
		</div>
		<div id="outOfRangeContent" class="panel-content">
			<div id="outOfRangeList">
				<div class="out-of-range-empty">æƒ…å ±ãªã—</div>
			</div>
		</div>
	</div>

	<div class="legend">
		<div class="panel-header">
			<h3>å¤©ä½“åˆ†é¡</h3>
			<button class="toggle-btn" onclick="togglePanel('legendContent')" title="ãƒ‘ãƒãƒ«ã‚’æŠ˜ã‚ŠãŸãŸã‚€">â–¼</button>
		</div>
		<div id="legendContent" class="panel-content">
			<div class="legend-category">
				<div class="legend-category-title">â–  ä¸»ç³»åˆ—æ˜Ÿ</div>
				<div class="legend-item" onclick="toggleStarVisibility('å¤ªé™½', event)">
					<input type="checkbox" id="check-å¤ªé™½" checked>
					<div class="legend-color" style="background-color: #FFD700;"></div>
					<span>å¤ªé™½ (1.0å€)</span>
				</div>
				<div class="legend-item" onclick="toggleStarVisibility('ã‚·ãƒªã‚¦ã‚¹A', event)">
					<input type="checkbox" id="check-ã‚·ãƒªã‚¦ã‚¹A" checked>
					<div class="legend-color" style="background-color: #87CEEB;"></div>
					<span>ã‚·ãƒªã‚¦ã‚¹A (1.7å€)</span>
				</div>
				<div class="legend-item" onclick="toggleStarVisibility('ã‚¢ãƒ«ã‚¿ã‚¤ãƒ«', event)">
					<input type="checkbox" id="check-ã‚¢ãƒ«ã‚¿ã‚¤ãƒ«" checked>
					<div class="legend-color" style="background-color: #ADD8E6;"></div>
					<span>ã‚¢ãƒ«ã‚¿ã‚¤ãƒ« (1.8å€)</span>
				</div>
				<div class="legend-item" onclick="toggleStarVisibility('ãƒ™ã‚¬', event)">
					<input type="checkbox" id="check-ãƒ™ã‚¬" checked>
					<div class="legend-color" style="background-color: #E0FFFF;"></div>
					<span>ãƒ™ã‚¬ (2.4å€)</span>
				</div>
			</div>
			<div class="legend-category">
				<div class="legend-category-title">â–  å·¨æ˜Ÿ</div>
				<div class="legend-item" onclick="toggleStarVisibility('ãƒãƒ«ãƒƒã‚¯ã‚¹', event)">
					<input type="checkbox" id="check-ãƒãƒ«ãƒƒã‚¯ã‚¹" checked>
					<div class="legend-color" style="background-color: #FFA07A;"></div>
					<span>ãƒãƒ«ãƒƒã‚¯ã‚¹ (8.8å€)</span>
				</div>
				<div class="legend-item" onclick="toggleStarVisibility('ã‚«ãƒšãƒ©', event)">
					<input type="checkbox" id="check-ã‚«ãƒšãƒ©" checked>
					<div class="legend-color" style="background-color: #FFFFE0;"></div>
					<span>ã‚«ãƒšãƒ© (12.2å€)</span>
				</div>
				<div class="legend-item" onclick="toggleStarVisibility('ã‚¢ãƒ«ã‚¯ãƒˆã‚¥ãƒ«ã‚¹', event)">
					<input type="checkbox" id="check-ã‚¢ãƒ«ã‚¯ãƒˆã‚¥ãƒ«ã‚¹" checked>
					<div class="legend-color" style="background-color: #FF8C00;"></div>
					<span>ã‚¢ãƒ«ã‚¯ãƒˆã‚¥ãƒ«ã‚¹ (25.4å€)</span>
				</div>
				<div class="legend-item" onclick="toggleStarVisibility('ã‚¢ãƒ«ãƒ‡ãƒãƒ©ãƒ³', event)">
					<input type="checkbox" id="check-ã‚¢ãƒ«ãƒ‡ãƒãƒ©ãƒ³" checked>
					<div class="legend-color" style="background-color: #FF6347;"></div>
					<span>ã‚¢ãƒ«ãƒ‡ãƒãƒ©ãƒ³ (44.2å€)</span>
				</div>
			</div>
			<div class="legend-category">
				<div class="legend-category-title">â–  è¶…å·¨æ˜Ÿ</div>
				<div class="legend-item" onclick="toggleStarVisibility('ãƒªã‚²ãƒ«', event)">
					<input type="checkbox" id="check-ãƒªã‚²ãƒ«" checked>
					<div class="legend-color" style="background-color: #B0E0E6;"></div>
					<span>ãƒªã‚²ãƒ« (78.9å€)</span>
				</div>
				<div class="legend-item" onclick="toggleStarVisibility('ãƒ‡ãƒãƒ–', event)">
					<input type="checkbox" id="check-ãƒ‡ãƒãƒ–" checked>
					<div class="legend-color" style="background-color: #F0F8FF;"></div>
					<span>ãƒ‡ãƒãƒ– (203å€)</span>
				</div>
				<div class="legend-item" onclick="toggleStarVisibility('ã‚¢ãƒ³ã‚¿ãƒ¬ã‚¹', event)">
					<input type="checkbox" id="check-ã‚¢ãƒ³ã‚¿ãƒ¬ã‚¹" checked>
					<div class="legend-color" style="background-color: #DC143C;"></div>
					<span>ã‚¢ãƒ³ã‚¿ãƒ¬ã‚¹ (680å€)</span>
				</div>
				<div class="legend-item" onclick="toggleStarVisibility('ãƒ™ãƒ†ãƒ«ã‚®ã‚¦ã‚¹', event)">
					<input type="checkbox" id="check-ãƒ™ãƒ†ãƒ«ã‚®ã‚¦ã‚¹" checked>
					<div class="legend-color" style="background-color: #FF4500;"></div>
					<span>ãƒ™ãƒ†ãƒ«ã‚®ã‚¦ã‚¹ (764å€)</span>
				</div>
			</div>
			<div class="legend-category">
				<div class="legend-category-title">â–  æ¥µè¶…å·¨æ˜Ÿ</div>
				<div class="legend-item" onclick="toggleStarVisibility('ãŠãŠã„ã¬åº§VYæ˜Ÿ', event)">
					<input type="checkbox" id="check-ãŠãŠã„ã¬åº§VYæ˜Ÿ" checked>
					<div class="legend-color" style="background-color: #8B0000;"></div>
					<span>ãŠãŠã„ã¬åº§VYæ˜Ÿ (1,420å€)</span>
				</div>
			</div>
		</div>
	</div>

	<script>
		// ========== å®šæ•°å®šç¾© ==========
		// å¤ªé™½ã®å®Ÿéš›ã®ç›´å¾„ï¼ˆkmï¼‰
		const SUN_ACTUAL_DIAMETER_KM = 1392700;

		// æ’æ˜Ÿãƒ‡ãƒ¼ã‚¿: åå‰ã€ç›´å¾„æ¯”ï¼ˆå¤ªé™½æ¯”ï¼‰ã€å®Ÿéš›ã®ç›´å¾„ï¼ˆkmï¼‰ã€è‰²ã€ç¨®åˆ¥ã€è·é›¢ï¼ˆå…‰å¹´ï¼‰
		const STARS = [
			{ name: 'å¤ªé™½', diameterRatio: 1.0, diameterKm: 1392700, color: '#FFD700', type: 'Gå‹ä¸»ç³»åˆ—æ˜Ÿ', distanceLY: 0, isSun: true },
			{ name: 'ã‚·ãƒªã‚¦ã‚¹A', diameterRatio: 1.7, diameterKm: 2367590, color: '#87CEEB', type: 'Aå‹ä¸»ç³»åˆ—æ˜Ÿ', distanceLY: 8.6, isSun: false },
			{ name: 'ã‚¢ãƒ«ã‚¿ã‚¤ãƒ«', diameterRatio: 1.8, diameterKm: 2508060, color: '#ADD8E6', type: 'Aå‹ä¸»ç³»åˆ—æ˜Ÿ', distanceLY: 17, isSun: false },
			{ name: 'ãƒ™ã‚¬', diameterRatio: 2.4, diameterKm: 3342480, color: '#E0FFFF', type: 'Aå‹ä¸»ç³»åˆ—æ˜Ÿ', distanceLY: 25, isSun: false },
			{ name: 'ãƒãƒ«ãƒƒã‚¯ã‚¹', diameterRatio: 8.8, diameterKm: 12255760, color: '#FFA07A', type: 'Kå‹å·¨æ˜Ÿ', distanceLY: 34, isSun: false },
			{ name: 'ã‚«ãƒšãƒ©', diameterRatio: 12.2, diameterKm: 16990940, color: '#FFFFE0', type: 'Gå‹å·¨æ˜Ÿ', distanceLY: 43, isSun: false },
			{ name: 'ã‚¢ãƒ«ã‚¯ãƒˆã‚¥ãƒ«ã‚¹', diameterRatio: 25.4, diameterKm: 35374580, color: '#FF8C00', type: 'Kå‹èµ¤è‰²å·¨æ˜Ÿ', distanceLY: 37, isSun: false },
			{ name: 'ã‚¢ãƒ«ãƒ‡ãƒãƒ©ãƒ³', diameterRatio: 44.2, diameterKm: 61557340, color: '#FF6347', type: 'Kå‹èµ¤è‰²å·¨æ˜Ÿ', distanceLY: 65, isSun: false },
			{ name: 'ãƒªã‚²ãƒ«', diameterRatio: 78.9, diameterKm: 109886130, color: '#B0E0E6', type: 'Bå‹è¶…å·¨æ˜Ÿ', distanceLY: 860, isSun: false },
			{ name: 'ãƒ‡ãƒãƒ–', diameterRatio: 203, diameterKm: 282757100, color: '#F0F8FF', type: 'Aå‹è¶…å·¨æ˜Ÿ', distanceLY: 2600, isSun: false },
			{ name: 'ã‚¢ãƒ³ã‚¿ãƒ¬ã‚¹', diameterRatio: 680, diameterKm: 946236000, color: '#DC143C', type: 'Må‹èµ¤è‰²è¶…å·¨æ˜Ÿ', distanceLY: 550, isSun: false },
			{ name: 'ãƒ™ãƒ†ãƒ«ã‚®ã‚¦ã‚¹', diameterRatio: 764, diameterKm: 1063982800, color: '#FF4500', type: 'Må‹èµ¤è‰²è¶…å·¨æ˜Ÿ', distanceLY: 640, isSun: false },
			{ name: 'ãŠãŠã„ã¬åº§VYæ˜Ÿ', diameterRatio: 1420, diameterKm: 1977634000, color: '#8B0000', type: 'Må‹æ¥µè¶…å·¨æ˜Ÿ', distanceLY: 3900, isSun: false }
		];

		// åˆæœŸä¸­å¿ƒåº§æ¨™: ã¿ã•ã¨å¤©æ–‡å°
		const INITIAL_CENTER = [135.40660, 34.14466]; // [çµŒåº¦, ç·¯åº¦]

		// ========== ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•° ==========
		let map;
		let sunMarker;
		let sunCoordinates = INITIAL_CENTER;
		let starVisibility = {}; // æ’æ˜Ÿã®è¡¨ç¤º/éè¡¨ç¤ºçŠ¶æ…‹ã‚’ç®¡ç†

		// åœ°å›³ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©
		const MAP_STYLES = {
			'osm': {
				version: 8,
				glyphs: 'https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf',
				sources: {
					'osm': {
						type: 'raster',
						tiles: [
							'https://a.tile.openstreetmap.org/{z}/{x}/{y}.png',
							'https://b.tile.openstreetmap.org/{z}/{x}/{y}.png',
							'https://c.tile.openstreetmap.org/{z}/{x}/{y}.png'
						],
						tileSize: 256,
						attribution: 'Â© OpenStreetMap contributors'
					}
				},
				layers: [{
					id: 'osm',
					type: 'raster',
					source: 'osm',
					minzoom: 0,
					maxzoom: 19
				}]
			},
			'gsi-std': {
				version: 8,
				glyphs: 'https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf',
				sources: {
					'gsi-std': {
						type: 'raster',
						tiles: [
							'https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png'
						],
						tileSize: 256,
						attribution: '<a href="https://maps.gsi.go.jp/development/ichiran.html" target="_blank">åœ°ç†é™¢ã‚¿ã‚¤ãƒ«</a>'
					}
				},
				layers: [{
					id: 'gsi-std',
					type: 'raster',
					source: 'gsi-std',
					minzoom: 0,
					maxzoom: 18
				}]
			},
			'gsi-pale': {
				version: 8,
				glyphs: 'https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf',
				sources: {
					'gsi-pale': {
						type: 'raster',
						tiles: [
							'https://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png'
						],
						tileSize: 256,
						attribution: '<a href="https://maps.gsi.go.jp/development/ichiran.html" target="_blank">åœ°ç†é™¢ã‚¿ã‚¤ãƒ«</a>'
					}
				},
				layers: [{
					id: 'gsi-pale',
					type: 'raster',
					source: 'gsi-pale',
					minzoom: 0,
					maxzoom: 18
				}]
			},
			'gsi-blank': {
				version: 8,
				glyphs: 'https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf',
				sources: {
					'gsi-blank': {
						type: 'raster',
						tiles: [
							'https://cyberjapandata.gsi.go.jp/xyz/blank/{z}/{x}/{y}.png'
						],
						tileSize: 256,
						attribution: '<a href="https://maps.gsi.go.jp/development/ichiran.html" target="_blank">åœ°ç†é™¢ã‚¿ã‚¤ãƒ«</a>'
					}
				},
				layers: [{
					id: 'gsi-blank-layer',
					type: 'raster',
					source: 'gsi-blank',
					minzoom: 0,
					maxzoom: 14
				}]
			},
			'gsi-photo': {
				version: 8,
				glyphs: 'https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf',
				sources: {
					'gsi-photo': {
						type: 'raster',
						tiles: [
							'https://cyberjapandata.gsi.go.jp/xyz/seamlessphoto/{z}/{x}/{y}.jpg'
						],
						tileSize: 256,
						attribution: '<a href="https://maps.gsi.go.jp/development/ichiran.html" target="_blank">åœ°ç†é™¢ã‚¿ã‚¤ãƒ«</a>'
					}
				},
				layers: [{
					id: 'gsi-photo',
					type: 'raster',
					source: 'gsi-photo',
					minzoom: 0,
					maxzoom: 18
				}]
			}
		};

		// ========== åˆæœŸåŒ– ==========
		function init() {
			// åœ°å›³ã®åˆæœŸåŒ–
			map = new maplibregl.Map({
				container: 'map',
				style: MAP_STYLES['osm'],
				center: INITIAL_CENTER,
				zoom: 14
			});

			// åœ°å›³ã®èª­ã¿è¾¼ã¿å®Œäº†å¾Œ
			map.on('load', () => {
				// å¤ªé™½ãƒãƒ¼ã‚«ãƒ¼ã®ä½œæˆ
				createSunMarker();

				// åˆæœŸæç”»
				updateStars();
			});

			// Enterã‚­ãƒ¼ã§æç”»æ›´æ–°
			document.getElementById('sunDiameter').addEventListener('keypress', (e) => {
				if (e.key === 'Enter') updateStars();
			});
		}

		// ========== å¤ªé™½ãƒãƒ¼ã‚«ãƒ¼ã®ä½œæˆ ==========
		function createSunMarker() {
			// ã‚«ã‚¹ã‚¿ãƒ ãƒãƒ¼ã‚«ãƒ¼è¦ç´ ã®ä½œæˆ
			const el = document.createElement('div');
			el.style.width = '30px';
			el.style.height = '30px';
			el.style.borderRadius = '50%';
			el.style.background = 'radial-gradient(circle, #FFD700, #FFA500)';
			el.style.border = '3px solid white';
			el.style.boxShadow = '0 0 15px rgba(255, 165, 0, 0.7)';
			el.style.cursor = 'move';

			// ãƒãƒ¼ã‚«ãƒ¼ã®ä½œæˆ
			sunMarker = new maplibregl.Marker({
				element: el,
				draggable: true
			})
				.setLngLat(sunCoordinates)
				.addTo(map);

			// ãƒ‰ãƒ©ãƒƒã‚°çµ‚äº†æ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆ
			sunMarker.on('dragend', () => {
				sunCoordinates = sunMarker.getLngLat().toArray();
				updateStars();
			});
		}

		// ========== æ’æ˜Ÿã®æ›´æ–°ãƒ»æç”» ==========
		function updateStars() {
			const sunDiameterM = parseFloat(document.getElementById('sunDiameter').value);

			if (isNaN(sunDiameterM) || sunDiameterM <= 0) {
				alert('æœ‰åŠ¹ãªå¤ªé™½ã®ç›´å¾„ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
				return;
			}

			// ç¸®å°ºä¿‚æ•°ã®è¨ˆç®—
			// Scale = å…¥åŠ›ã•ã‚ŒãŸå¤ªé™½ã®ç›´å¾„(m) / (å¤ªé™½ã®å®Ÿéš›ã®ç›´å¾„(km) Ã— 1000)
			const scale = sunDiameterM / (SUN_ACTUAL_DIAMETER_KM * 1000);

			console.log(`ç¸®å°º: å¤ªé™½ ${sunDiameterM} m`);

			// ç¯„å›²å¤–ã®æ’æ˜Ÿãƒªã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢
			window.outOfRangeStars = [];

			// åˆå›å®Ÿè¡Œæ™‚ã¯å…¨æ’æ˜Ÿã‚’è¡¨ç¤ºçŠ¶æ…‹ã«è¨­å®š
			if (Object.keys(starVisibility).length === 0) {
				STARS.forEach(star => {
					starVisibility[star.name] = true;
				});
			}

			// æ—¢å­˜ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤
			STARS.forEach(star => {
				const fillLayerId = `star-fill-${star.name}`;
				const fillSourceId = `star-fill-source-${star.name}`;
				const outlineLayerId = `star-outline-${star.name}`;
				const outlineSourceId = `star-outline-source-${star.name}`;
				const labelLayerId = `label-${star.name}`;
				const labelSourceId = `label-source-${star.name}`;

				if (map.getLayer(fillLayerId)) {
					map.removeLayer(fillLayerId);
				}
				if (map.getSource(fillSourceId)) {
					map.removeSource(fillSourceId);
				}
				if (map.getLayer(outlineLayerId)) {
					map.removeLayer(outlineLayerId);
				}
				if (map.getSource(outlineSourceId)) {
					map.removeSource(outlineSourceId);
				}
				if (map.getLayer(labelLayerId)) {
					map.removeLayer(labelLayerId);
				}
				if (map.getSource(labelSourceId)) {
					map.removeSource(labelSourceId);
				}
			});

			// æ’æ˜Ÿã‚’ç›´å¾„ã®å°ã•ã„é †ã«ã‚½ãƒ¼ãƒˆ
			const sortedStars = [...STARS].sort((a, b) => a.diameterRatio - b.diameterRatio);

			// å„æ’æ˜Ÿã‚’æç”»ï¼ˆå¤§ãã„é †ã«æç”»ã™ã‚‹ãŸã‚é€†é †ã«ã™ã‚‹ï¼‰
			sortedStars.reverse().forEach(star => {
				// å¤ªé™½ã¯ãƒãƒ¼ã‚«ãƒ¼ã¨ã—ã¦è¡¨ç¤ºæ¸ˆã¿ãªã®ã§ã‚¹ã‚­ãƒƒãƒ—
				if (star.isSun) {
					return;
				}

				// éè¡¨ç¤ºè¨­å®šã®æ’æ˜Ÿã¯ã‚¹ã‚­ãƒƒãƒ—
				if (!starVisibility[star.name]) {
					return;
				}

				// æ’æ˜Ÿã®ç›´å¾„ï¼ˆãƒ¡ãƒ¼ãƒˆãƒ«ï¼‰ã‚’è¨ˆç®—
				const starDiameterM = star.diameterKm * 1000 * scale;
				const starRadiusKm = (starDiameterM / 2) / 1000;

				// åŠå¾„ãŒ20,000kmã‚’è¶…ãˆã‚‹å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—ã—ã€æƒ…å ±ã‚’è¨˜éŒ²
				if (starRadiusKm > 20000) {
					// åœ°çƒã®å††å‘¨ï¼ˆèµ¤é“å‘¨å›²ï¼‰: ç´„40,075km
					const earthCircumference = 40075;
					const diameterKm = starRadiusKm * 2;
					const timesAroundEarth = diameterKm / earthCircumference;
					console.log(`${star.name}: åŠå¾„ ${starRadiusKm.toFixed(2)} km (ç›´å¾„ ${diameterKm.toFixed(2)} km, åœ°çƒ${timesAroundEarth.toFixed(2)}å‘¨åˆ†) - è¡¨ç¤ºç¯„å›²å¤–ã®ãŸã‚ã‚¹ã‚­ãƒƒãƒ—`);

					// ç¯„å›²å¤–ã®æ’æ˜Ÿæƒ…å ±ã‚’ä¿å­˜
					window.outOfRangeStars.push({
						name: star.name,
						color: star.color,
						type: star.type,
						radiusKm: starRadiusKm,
						diameterKm: diameterKm,
						timesAroundEarth: timesAroundEarth
					});

					return;
				}

				// æ’æ˜Ÿã®å††ã‚’ç”Ÿæˆï¼ˆå¤ªé™½ã®ä½ç½®ã‚’ä¸­å¿ƒã«ï¼‰
				const starCircle = turf.circle(sunCoordinates, starRadiusKm, {
					steps: 64,
					units: 'kilometers'
				});

				const fillSourceId = `star-fill-source-${star.name}`;
				const fillLayerId = `star-fill-${star.name}`;
				const outlineSourceId = `star-outline-source-${star.name}`;
				const outlineLayerId = `star-outline-${star.name}`;

				// æ’æ˜Ÿã®å¡—ã‚Šã¤ã¶ã—ã‚½ãƒ¼ã‚¹ã¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¿½åŠ 
				map.addSource(fillSourceId, {
					type: 'geojson',
					data: starCircle
				});

				map.addLayer({
					id: fillLayerId,
					type: 'fill',
					source: fillSourceId,
					paint: {
						'fill-color': star.color,
						'fill-opacity': 0.3
					}
				});

				// æ’æ˜Ÿã®ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚½ãƒ¼ã‚¹ã¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¿½åŠ 
				map.addSource(outlineSourceId, {
					type: 'geojson',
					data: starCircle
				});

				map.addLayer({
					id: outlineLayerId,
					type: 'line',
					source: outlineSourceId,
					paint: {
						'line-color': star.color,
						'line-width': 4,
						'line-opacity': 0.8
					}
				});				// æ’æ˜Ÿã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
				map.on('click', fillLayerId, (e) => {
					const coordinates = e.lngLat;
					const diameterKm = starRadiusKm * 2;

					const popupContent = `
						<div style="font-family: 'Segoe UI', sans-serif; min-width: 250px;">
							<h3 style="margin: 0 0 10px 0; color: ${star.color}; font-size: 16px;">
								${star.name}
							</h3>
							<div style="font-size: 13px; line-height: 1.6;">
								<p style="margin: 5px 0;"><strong>å®Ÿéš›ã®ç›´å¾„:</strong> ${star.diameterKm.toLocaleString()} km</p>
								<p style="margin: 5px 0;"><strong>å¤ªé™½ã®ç›´å¾„æ¯”:</strong> ${star.diameterRatio}å€</p>
								<p style="margin: 5px 0;"><strong>ç¨®åˆ¥:</strong> ${star.type}</p>
								<p style="margin: 5px 0;"><strong>åœ°çƒã‹ã‚‰ã®è·é›¢:</strong> ${star.distanceLY.toLocaleString()} å…‰å¹´</p>
								<hr style="margin: 10px 0; border: none; border-top: 1px solid #ddd;">
								<p style="margin: 5px 0;"><strong>åœ°å›³ä¸Šã§ã®ç›´å¾„:</strong> ${diameterKm.toFixed(2)} km (${(diameterKm * 1000).toFixed(0)} m)</p>
								<hr style="margin: 10px 0; border: none; border-top: 1px solid #ddd;">
								<p style="margin: 5px 0;">
									<a href="https://www.google.com/maps?q=${coordinates.lat},${coordinates.lng}" 
									   target="_blank" 
									   style="color: #4CAF50; text-decoration: none;">
										ğŸ“ Google Mapsã§ã“ã®å ´æ‰€ã‚’è¦‹ã‚‹
									</a>
								</p>
							</div>
						</div>
					`;

					new maplibregl.Popup({
						maxWidth: '350px'
					})
						.setLngLat(coordinates)
						.setHTML(popupContent)
						.addTo(map);
				});

				// ãƒã‚¦ã‚¹ã‚«ãƒ¼ã‚½ãƒ«ã‚’ãƒã‚¤ãƒ³ã‚¿ãƒ¼ã«å¤‰æ›´
				map.on('mouseenter', fillLayerId, () => {
					map.getCanvas().style.cursor = 'pointer';
				});

				map.on('mouseleave', fillLayerId, () => {
					map.getCanvas().style.cursor = '';
				});

				// æ’æ˜Ÿãƒ©ãƒ™ãƒ«ã®è¿½åŠ 
				const labelSourceId = `label-source-${star.name}`;
				const labelLayerId = `label-${star.name}`;

				// ãƒ©ãƒ™ãƒ«ä½ç½®ã‚’å††ã®å¤–å‘¨ä¸Šã«æ”¾å°„çŠ¶ã«é…ç½®
				const starIndex = STARS.findIndex(s => s.name === star.name);
				const visibleStars = STARS.filter(s => !s.isSun); // å¤ªé™½ã‚’é™¤ã
				const visibleIndex = visibleStars.findIndex(s => s.name === star.name);
				const angleStep = 360 / visibleStars.length; // è¡¨ç¤ºæ’æ˜Ÿæ•°ã§è§’åº¦ã‚’åˆ†å‰²
				const labelAngle = visibleIndex * angleStep; // å„æ’æ˜Ÿã«ç•°ãªã‚‹è§’åº¦ã‚’å‰²ã‚Šå½“ã¦

				// ãƒ©ãƒ™ãƒ«ã‚’å††ã®å¤–å‘¨ç·šã®å°‘ã—å†…å´ã«é…ç½®ï¼ˆåŠå¾„ã®0.85å€ã®è·é›¢ï¼‰
				const labelDistanceKm = starRadiusKm * 0.85;

				// ãƒ©ãƒ™ãƒ«ä½ç½®ã‚’è¨ˆç®—
				const labelPosition = turf.destination(sunCoordinates, labelDistanceKm, labelAngle, { units: 'kilometers' }); const labelPoint = turf.point(labelPosition.geometry.coordinates, {
					name: star.name
				});

				map.addSource(labelSourceId, {
					type: 'geojson',
					data: labelPoint
				});				// ãƒ©ãƒ™ãƒ«ã‚µã‚¤ã‚ºã‚’æ’æ˜Ÿã®ç¨®é¡ã«ã‚ˆã£ã¦èª¿æ•´
				let textSize = 14;
				if (star.type.includes('ä¸»ç³»åˆ—æ˜Ÿ')) {
					textSize = 16;
				} else if (star.type.includes('å·¨æ˜Ÿ') && !star.type.includes('è¶…å·¨æ˜Ÿ')) {
					textSize = 18;
				} else if (star.type.includes('è¶…å·¨æ˜Ÿ')) {
					textSize = 20;
				} else if (star.type.includes('æ¥µè¶…å·¨æ˜Ÿ')) {
					textSize = 24;
				}

				map.addLayer({
					id: labelLayerId,
					type: 'symbol',
					source: labelSourceId,
					layout: {
						'text-field': ['get', 'name'],
						'text-font': ['Open Sans Bold', 'Arial Unicode MS Bold'],
						'text-size': textSize,
						'text-offset': [0, -2.5],
						'text-anchor': 'bottom',
						'text-allow-overlap': true,
						'text-ignore-placement': true
					},
					paint: {
						'text-color': star.color,
						'text-halo-color': '#ffffff',
						'text-halo-width': 3
					}
				});

				console.log(`${star.name}: ç›´å¾„ ${starDiameterM.toFixed(2)} m (åŠå¾„ ${starRadiusKm.toFixed(2)} km)`);
			});

			// ç¯„å›²å¤–ã®æ’æ˜Ÿãƒªã‚¹ãƒˆã‚’æ›´æ–°
			updateOutOfRangeList();
		}

		// ========== æç”»ç¯„å›²å¤–ã®æ’æ˜Ÿãƒªã‚¹ãƒˆã‚’æ›´æ–° ==========
		function updateOutOfRangeList() {
			const listElement = document.getElementById('outOfRangeList');

			if (!window.outOfRangeStars || window.outOfRangeStars.length === 0) {
				listElement.innerHTML = '<div class="out-of-range-empty">ã™ã¹ã¦ã®æ’æ˜ŸãŒè¡¨ç¤ºç¯„å›²å†…ã§ã™</div>';
				return;
			}

			let html = '';
			window.outOfRangeStars.forEach(star => {
				html += `<div class="out-of-range-item" style="border-left-color: ${star.color};">`;
				html += `<strong>${star.name}</strong><br>`;
				html += `åŠå¾„: ${star.radiusKm.toLocaleString('ja-JP', { maximumFractionDigits: 0 })} km<br>`;
				html += `åœ°çƒ <strong>${star.timesAroundEarth.toFixed(1)}</strong> å‘¨åˆ†<br>`;
				html += `(ç¨®åˆ¥: ${star.type})`;
				html += `</div>`;
			});

			listElement.innerHTML = html;
		}

		// ========== åœ°å›³ã‚¹ã‚¿ã‚¤ãƒ«åˆ‡ã‚Šæ›¿ãˆ ==========
		function changeMapStyle() {
			const selectedStyle = document.getElementById('mapStyle').value;

			// ç¾åœ¨ã®ä¸­å¿ƒåº§æ¨™ã¨ã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«ã‚’ä¿å­˜
			const currentCenter = map.getCenter();
			const currentZoom = map.getZoom();
			const currentSunCoords = sunCoordinates;

			// åœ°å›³ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å¤‰æ›´
			map.setStyle(MAP_STYLES[selectedStyle]);

			// ã‚¹ã‚¿ã‚¤ãƒ«èª­ã¿è¾¼ã¿å®Œäº†å¾Œã«æ’æ˜Ÿã‚’å†æç”»
			map.once('styledata', () => {
				// ä¸­å¿ƒåº§æ¨™ã¨ã‚ºãƒ¼ãƒ ã‚’å¾©å…ƒ
				map.setCenter(currentCenter);
				map.setZoom(currentZoom);

				// å¤ªé™½ã®ä½ç½®ã‚’å¾©å…ƒ
				sunCoordinates = currentSunCoords;
				if (sunMarker) {
					sunMarker.setLngLat(sunCoordinates);
				}

				// æ’æ˜Ÿã‚’å†æç”»
				updateStars();
			});
		}

		// ========== å…¨ç”»é¢ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ ==========
		function toggleFullscreen() {
			if (!document.fullscreenElement) {
				// å…¨ç”»é¢ãƒ¢ãƒ¼ãƒ‰ã«å…¥ã‚‹
				document.documentElement.requestFullscreen().catch(err => {
					alert(`å…¨ç”»é¢ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆã§ãã¾ã›ã‚“ã§ã—ãŸ: ${err.message}`);
				});
			} else {
				// å…¨ç”»é¢ãƒ¢ãƒ¼ãƒ‰ã‚’çµ‚äº†
				if (document.exitFullscreen) {
					document.exitFullscreen();
				}
			}
		}

		// å…¨ç”»é¢ãƒ¢ãƒ¼ãƒ‰ã®å¤‰åŒ–ã‚’ç›£è¦–ã—ã¦ãƒœã‚¿ãƒ³ã‚¢ã‚¤ã‚³ãƒ³ã‚’æ›´æ–°
		document.addEventListener('fullscreenchange', () => {
			const btn = document.querySelector('.fullscreen-btn');
			if (document.fullscreenElement) {
				btn.textContent = 'âŒ'; // å…¨ç”»é¢ä¸­ã¯çµ‚äº†ã‚¢ã‚¤ã‚³ãƒ³
				btn.title = 'å…¨ç”»é¢ãƒ¢ãƒ¼ãƒ‰ã‚’çµ‚äº†';
			} else {
				btn.textContent = 'â›¶'; // é€šå¸¸æ™‚ã¯å…¨ç”»é¢ã‚¢ã‚¤ã‚³ãƒ³
				btn.title = 'å…¨ç”»é¢ãƒ¢ãƒ¼ãƒ‰';
			}
		});

		// ========== ç¾åœ¨åœ°ã‚’ä¸­å¿ƒã«ã™ã‚‹ ==========
		function setCurrentLocation() {
			const locationBtn = document.querySelector('.location-btn');

			if (!navigator.geolocation) {
				alert('ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ä½ç½®æƒ…å ±æ©Ÿèƒ½ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚');
				return;
			}

			// ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
			locationBtn.disabled = true;
			locationBtn.textContent = 'ğŸ“¡';

			navigator.geolocation.getCurrentPosition(
				// æˆåŠŸæ™‚
				(position) => {
					const { latitude, longitude } = position.coords;

					// ä¸­å¿ƒä½ç½®ã‚’ç¾åœ¨åœ°ã«æ›´æ–°
					sunCoordinates = [longitude, latitude];

					// ãƒãƒ¼ã‚«ãƒ¼ã®ä½ç½®ã‚’æ›´æ–°
					if (sunMarker) {
						sunMarker.setLngLat(sunCoordinates);
					}

					// åœ°å›³ã®ä¸­å¿ƒã‚’ç¾åœ¨åœ°ã«ç§»å‹•
					map.flyTo({
						center: sunCoordinates,
						zoom: 14,
						duration: 2000
					});

					// æç”»ã‚’æ›´æ–°
					updateStars();

					// ãƒœã‚¿ãƒ³ã‚’å…ƒã«æˆ»ã™
					locationBtn.disabled = false;
					locationBtn.textContent = 'ğŸ“';
				},
				// ã‚¨ãƒ©ãƒ¼æ™‚
				(error) => {
					let errorMessage = 'ä½ç½®æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚';

					switch (error.code) {
						case error.PERMISSION_DENIED:
							errorMessage = 'ä½ç½®æƒ…å ±ã®ä½¿ç”¨ãŒè¨±å¯ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚';
							break;
						case error.POSITION_UNAVAILABLE:
							errorMessage = 'ä½ç½®æƒ…å ±ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚';
							break;
						case error.TIMEOUT:
							errorMessage = 'ä½ç½®æƒ…å ±ã®å–å¾—ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸã€‚';
							break;
					}

					alert(errorMessage);

					// ãƒœã‚¿ãƒ³ã‚’å…ƒã«æˆ»ã™
					locationBtn.disabled = false;
					locationBtn.textContent = 'ğŸ“';
				},
				// ã‚ªãƒ—ã‚·ãƒ§ãƒ³
				{
					enableHighAccuracy: true,
					timeout: 10000,
					maximumAge: 0
				}
			);
		}

		// ========== ãƒ‘ãƒãƒ«ã®æŠ˜ã‚ŠãŸãŸã¿ ==========
		function togglePanel(contentId) {
			const content = document.getElementById(contentId);
			const button = event.target;

			if (content.classList.contains('collapsed')) {
				content.classList.remove('collapsed');
				content.style.maxHeight = content.scrollHeight + 'px';
				button.textContent = 'â–¼';
			} else {
				content.style.maxHeight = content.scrollHeight + 'px';
				setTimeout(() => {
					content.classList.add('collapsed');
				}, 10);
				button.textContent = 'â–¶';
			}
		}

		// ========== æ’æ˜Ÿã®è¡¨ç¤º/éè¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ ==========
		function toggleStarVisibility(starName, event) {
			// ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹è‡ªä½“ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸå ´åˆã¯ã€æ—¢ã«ãƒã‚§ãƒƒã‚¯çŠ¶æ…‹ãŒå¤‰æ›´ã•ã‚Œã¦ã„ã‚‹ã®ã§ä½•ã‚‚ã—ãªã„
			const checkbox = document.getElementById(`check-${starName}`);
			const isCheckboxClick = event && event.target.type === 'checkbox';

			// ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ä»¥å¤–ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸå ´åˆã¯ã€ãƒã‚§ãƒƒã‚¯çŠ¶æ…‹ã‚’åè»¢
			if (!isCheckboxClick) {
				checkbox.checked = !checkbox.checked;
			}

			starVisibility[starName] = checkbox.checked;

			const fillLayerId = `star-fill-${starName}`;
			const outlineLayerId = `star-outline-${starName}`;
			const labelLayerId = `label-${starName}`;

			const visibility = checkbox.checked ? 'visible' : 'none';

			// å¤ªé™½ãƒãƒ¼ã‚«ãƒ¼ã®è¡¨ç¤º/éè¡¨ç¤º
			if (starName === 'å¤ªé™½' && sunMarker) {
				const markerElement = sunMarker.getElement();
				if (markerElement) {
					markerElement.style.display = checkbox.checked ? 'block' : 'none';
				}
				return;
			}

			// æ’æ˜Ÿãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è¡¨ç¤º/éè¡¨ç¤º
			if (map.getLayer(fillLayerId)) {
				map.setLayoutProperty(fillLayerId, 'visibility', visibility);
			}
			if (map.getLayer(outlineLayerId)) {
				map.setLayoutProperty(outlineLayerId, 'visibility', visibility);
			}
			if (map.getLayer(labelLayerId)) {
				map.setLayoutProperty(labelLayerId, 'visibility', visibility);
			}
		}

		// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å„ãƒ‘ãƒãƒ«ã®åˆæœŸmaxHeightã‚’è¨­å®š
		window.addEventListener('load', () => {
			init();

			// å„ãƒ‘ãƒãƒ«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åˆæœŸmaxHeightã‚’è¨­å®š
			['controlContent', 'outOfRangeContent', 'legendContent'].forEach(id => {
				const element = document.getElementById(id);
				if (element) {
					element.style.maxHeight = element.scrollHeight + 'px';
				}
			});
		});
	</script>
</body>

</html>
<!DOCTYPE html>
<html lang="ja">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>æ’æ˜Ÿé–“è·é›¢ä½“æ„Ÿãƒãƒƒãƒ—</title>
	<meta name="description" content="ä¸»ãªæ’æ˜Ÿé–“ã®è·é›¢ã‚’åœ°å›³ä¸Šã«ç¸®å°ºè¡¨ç¤ºã—ã€å®‡å®™ã®åºƒå¤§ã•ã‚’ä½“æ„Ÿã§ãã‚‹ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒƒãƒ—">
	<meta property="og:title" content="æ’æ˜Ÿé–“è·é›¢ä½“æ„Ÿãƒãƒƒãƒ—">
	<meta property="og:description" content="ä¸»ãªæ’æ˜Ÿé–“ã®è·é›¢ã‚’åœ°å›³ä¸Šã«ç¸®å°ºè¡¨ç¤ºã—ã€å®‡å®™ã®åºƒå¤§ã•ã‚’ä½“æ„Ÿã§ãã‚‹ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒƒãƒ—">
	<meta property="og:type" content="website">

	<!-- Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-89GN3KL35R"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag() { dataLayer.push(arguments); }
		gtag('js', new Date());
		gtag('config', 'G-89GN3KL35R');
	</script>

	<!-- MapLibre GL JS -->
	<script src="https://unpkg.com/maplibre-gl@5.0.0/dist/maplibre-gl.js"></script>
	<link href="https://unpkg.com/maplibre-gl@5.0.0/dist/maplibre-gl.css" rel="stylesheet" />

	<!-- Turf.js -->
	<script src="https://cdn.jsdelivr.net/npm/@turf/turf@6.5.0/turf.min.js"></script>

	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
		}

		#map {
			position: absolute;
			top: 0;
			bottom: 0;
			width: 100%;
		}

		.control-panel {
			position: absolute;
			top: 20px;
			left: 20px;
			background: white;
			padding: 20px;
			border-radius: 8px;
			box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
			z-index: 1000;
			min-width: 320px;
		}

		.control-panel h2 {
			margin-bottom: 15px;
			font-size: 18px;
			color: #333;
		}

		.input-group {
			margin-bottom: 15px;
		}

		.input-group label {
			display: block;
			margin-bottom: 5px;
			font-size: 14px;
			color: #555;
		}

		.input-group input {
			width: 100%;
			padding: 8px;
			border: 1px solid #ddd;
			border-radius: 4px;
			font-size: 14px;
		}

		.input-group input:focus {
			outline: none;
			border-color: #4CAF50;
		}

		.preset-buttons {
			display: flex;
			gap: 8px;
			margin-bottom: 15px;
		}

		.preset-btn {
			flex: 1;
			padding: 8px;
			background-color: #2196F3;
			color: white;
			border: none;
			border-radius: 4px;
			font-size: 12px;
			cursor: pointer;
			transition: background-color 0.3s;
		}

		.preset-btn:hover {
			background-color: #0b7dda;
		}

		.update-btn {
			width: 100%;
			padding: 10px;
			background-color: #4CAF50;
			color: white;
			border: none;
			border-radius: 4px;
			font-size: 16px;
			cursor: pointer;
			transition: background-color 0.3s;
		}

		.update-btn:hover {
			background-color: #45a049;
		}

		.map-selector {
			margin-bottom: 15px;
		}

		.map-selector label {
			display: block;
			margin-bottom: 5px;
			font-size: 14px;
			color: #555;
		}

		.map-selector select {
			width: 100%;
			padding: 8px;
			border: 1px solid #ddd;
			border-radius: 4px;
			font-size: 14px;
			background-color: white;
			cursor: pointer;
		}

		.map-selector select:focus {
			outline: none;
			border-color: #4CAF50;
		}

		.legend {
			position: absolute;
			bottom: 30px;
			right: 20px;
			background: white;
			padding: 15px;
			border-radius: 8px;
			box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
			z-index: 1000;
			max-height: 400px;
			overflow-y: auto;
		}

		.legend h3 {
			margin-bottom: 10px;
			font-size: 14px;
			color: #333;
		}

		.legend-item {
			display: flex;
			align-items: center;
			margin-bottom: 5px;
			font-size: 12px;
		}

		.legend-color {
			width: 20px;
			height: 3px;
			margin-right: 8px;
			border-radius: 2px;
		}

		.info-text {
			font-size: 12px;
			color: #666;
			margin-top: 10px;
		}

		.out-of-range {
			position: absolute;
			top: 20px;
			right: 20px;
			background: white;
			padding: 15px;
			border-radius: 8px;
			box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
			z-index: 1000;
			max-width: 350px;
			max-height: 400px;
			overflow-y: auto;
		}

		.out-of-range h3 {
			margin-bottom: 10px;
			font-size: 14px;
			color: #333;
		}

		.out-of-range-item {
			font-size: 12px;
			color: #666;
			margin-bottom: 5px;
			padding: 5px;
			border-left: 3px solid;
			padding-left: 8px;
		}

		.out-of-range-empty {
			font-size: 12px;
			color: #999;
			font-style: italic;
		}

		.panel-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 10px;
		}

		.panel-header h2,
		.panel-header h3 {
			margin-bottom: 0;
		}

		.toggle-btn {
			background: none;
			border: none;
			font-size: 18px;
			cursor: pointer;
			padding: 5px;
			color: #666;
			transition: color 0.3s;
		}

		.toggle-btn:hover {
			color: #333;
		}

		.panel-content {
			transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
			overflow: hidden;
		}

		.panel-content.collapsed {
			max-height: 0 !important;
			opacity: 0;
			margin: 0;
			padding: 0;
		}

		.fullscreen-btn {
			position: absolute;
			bottom: 30px;
			left: 20px;
			background: white;
			border: none;
			border-radius: 4px;
			padding: 10px 15px;
			font-size: 20px;
			cursor: pointer;
			box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
			z-index: 1000;
			transition: background-color 0.3s;
		}

		.fullscreen-btn:hover {
			background-color: #f0f0f0;
		}
	</style>
</head>

<body>
	<div id="map"></div>

	<button class="fullscreen-btn" onclick="toggleFullscreen()" title="å…¨ç”»é¢ãƒ¢ãƒ¼ãƒ‰">â›¶</button>

	<div class="control-panel">
		<div class="panel-header">
			<h2>â­ æ’æ˜Ÿé–“è·é›¢ä½“æ„Ÿãƒãƒƒãƒ—</h2>
			<button class="toggle-btn" onclick="togglePanel('controlContent')" title="ãƒ‘ãƒãƒ«ã‚’æŠ˜ã‚ŠãŸãŸã‚€">â–¼</button>
		</div>

		<div id="controlContent" class="panel-content">
			<div class="map-selector">
				<label for="mapStyle">èƒŒæ™¯åœ°å›³:</label>
				<select id="mapStyle" onchange="changeMapStyle()">
					<option value="osm">OpenStreetMap</option>
					<option value="gsi-std">åœ°ç†é™¢åœ°å›³(æ¨™æº–)</option>
					<option value="gsi-pale">åœ°ç†é™¢åœ°å›³(æ·¡è‰²)</option>
					<option value="gsi-blank">åœ°ç†é™¢åœ°å›³(ç™½åœ°å›³)</option>
					<option value="gsi-photo">åœ°ç†é™¢åœ°å›³(è¡›æ˜Ÿå†™çœŸ)</option>
				</select>
			</div>

			<div class="input-group">
				<label for="scaleKm">1å…‰å¹´ = ä½•km:</label>
				<input type="number" id="scaleKm" value="1" step="1" min="1">
			</div>

			<button class="update-btn" onclick="updateStars()">æç”»æ›´æ–°</button>

			<div class="info-text">
				â„¹ï¸ å¤ªé™½ãƒãƒ¼ã‚«ãƒ¼ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ä½ç½®ã‚’å¤‰æ›´ã§ãã¾ã™
			</div>
		</div>
	</div>

	<div class="out-of-range" id="outOfRange">
		<div class="panel-header">
			<h3>ğŸ“ æç”»ç¯„å›²å¤–ã®æ’æ˜Ÿ</h3>
			<button class="toggle-btn" onclick="togglePanel('outOfRangeContent')" title="ãƒ‘ãƒãƒ«ã‚’æŠ˜ã‚ŠãŸãŸã‚€">â–¼</button>
		</div>
		<div id="outOfRangeContent" class="panel-content">
			<div id="outOfRangeList">
				<div class="out-of-range-empty">æƒ…å ±ãªã—</div>
			</div>
		</div>
	</div>

	<div class="legend">
		<div class="panel-header">
			<h3>æ’æ˜Ÿãƒªã‚¹ãƒˆ</h3>
			<button class="toggle-btn" onclick="togglePanel('legendContent')" title="ãƒ‘ãƒãƒ«ã‚’æŠ˜ã‚ŠãŸãŸã‚€">â–¼</button>
		</div>
		<div id="legendContent" class="panel-content">
			<div id="legendList"></div>
		</div>
	</div>

	<script>
		// ========== å®šæ•°å®šç¾© ==========
		// 1å…‰å¹´ = 9.461å…†km
		const LIGHT_YEAR_IN_KM = 9.461e12;

		// åˆæœŸä¸­å¿ƒåº§æ¨™: ã¿ã•ã¨å¤©æ–‡å°
		const INITIAL_CENTER = [135.40660, 34.14466]; // [çµŒåº¦, ç·¯åº¦]

		// æ’æ˜Ÿãƒ‡ãƒ¼ã‚¿: åå‰ã€è·é›¢(å…‰å¹´)ã€ç›´å¾„(å¤ªé™½æ¯”)ã€è‰²ã€æ‰€å±æ˜Ÿåº§ã€æ–¹ä½è§’(åº¦)
		const STARS = [
			{ name: 'ã‚·ãƒªã‚¦ã‚¹', distanceLY: 8.60, diameterSolar: 1.71, color: '#87CEEB', constellation: 'ãŠãŠã„ã¬åº§Î±æ˜Ÿ', azimuth: 180 },
			{ name: 'ã‚«ãƒãƒ¼ãƒ—ã‚¹', distanceLY: 310, diameterSolar: 65, color: '#FFF8DC', constellation: 'ã‚Šã‚…ã†ã“ã¤åº§Î±æ˜Ÿ', azimuth: 150 },
			{ name: 'ã‚¢ãƒ¼ã‚¯ãƒˆã‚¥ãƒ«ã‚¹', distanceLY: 36.66, diameterSolar: 25.4, color: '#FF8C00', constellation: 'ã†ã—ã‹ã„åº§Î±æ˜Ÿ', azimuth: 270 },
			{ name: 'ãƒ™ã‚¬', distanceLY: 25.04, diameterSolar: 2.36, color: '#E0FFFF', constellation: 'ã“ã¨åº§Î±æ˜Ÿ', azimuth: 330 },
			{ name: 'ã‚«ãƒšãƒ©', distanceLY: 42.92, diameterSolar: 12.2, color: '#FFFFE0', constellation: 'ãã‚‡ã—ã‚ƒåº§Î±æ˜Ÿ', azimuth: 30 },
			{ name: 'ãƒªã‚²ãƒ«', distanceLY: 860, diameterSolar: 78.9, color: '#B0E2FF', constellation: 'ã‚ªãƒªã‚ªãƒ³åº§Î²æ˜Ÿ', azimuth: 120 },
			{ name: 'ãƒ—ãƒ­ã‚­ã‚ªãƒ³', distanceLY: 11.46, diameterSolar: 1.42, color: '#FFFACD', constellation: 'ã“ã„ã¬åº§Î±æ˜Ÿ', azimuth: 160 },
			{ name: 'ãƒ™ãƒ†ãƒ«ã‚®ã‚¦ã‚¹', distanceLY: 548, diameterSolar: 764, color: '#FF4500', constellation: 'ã‚ªãƒªã‚ªãƒ³åº§Î±æ˜Ÿ', azimuth: 140 },
			{ name: 'ã‚¢ãƒ«ã‚¿ã‚¤ãƒ«', distanceLY: 16.73, diameterSolar: 1.63, color: '#F0F8FF', constellation: 'ã‚ã—åº§Î±æ˜Ÿ', azimuth: 300 },
			{ name: 'ã‚¢ãƒ«ãƒ‡ãƒãƒ©ãƒ³', distanceLY: 65.23, diameterSolar: 44.2, color: '#FF6347', constellation: 'ãŠã†ã—åº§Î±æ˜Ÿ', azimuth: 80 },
			{ name: 'ã‚¢ãƒ³ã‚¿ãƒ¬ã‚¹', distanceLY: 550, diameterSolar: 883, color: '#DC143C', constellation: 'ã•ãã‚Šåº§Î±æ˜Ÿ', azimuth: 230 },
			{ name: 'ã‚¹ãƒ”ã‚«', distanceLY: 250, diameterSolar: 7.4, color: '#B8E0F0', constellation: 'ãŠã¨ã‚åº§Î±æ˜Ÿ', azimuth: 240 },
			{ name: 'ãƒãƒ«ãƒƒã‚¯ã‚¹', distanceLY: 33.78, diameterSolar: 8.8, color: '#FFB6C1', constellation: 'ãµãŸã”åº§Î²æ˜Ÿ', azimuth: 100 },
			{ name: 'ãƒ•ã‚©ãƒ¼ãƒãƒ«ãƒã‚¦ãƒˆ', distanceLY: 25.13, diameterSolar: 1.84, color: '#FFF0F5', constellation: 'ã¿ãªã¿ã®ã†ãŠåº§Î±æ˜Ÿ', azimuth: 200 },
			{ name: 'ãƒ‡ãƒãƒ–', distanceLY: 2600, diameterSolar: 203, color: '#F0F8FF', constellation: 'ã¯ãã¡ã‚‡ã†åº§Î±æ˜Ÿ', azimuth: 340 },
			{ name: 'ãƒ¬ã‚°ãƒ«ã‚¹', distanceLY: 79.3, diameterSolar: 3.9, color: '#E8F0FF', constellation: 'ã—ã—åº§Î±æ˜Ÿ', azimuth: 190 },
			{ name: 'ã‚«ã‚¹ãƒˆãƒ«', distanceLY: 51.6, diameterSolar: 1.7, color: '#F5F8FF', constellation: 'ãµãŸã”åº§Î±æ˜Ÿ', azimuth: 90 },
			{ name: 'ãƒŸãƒ©ã‚¯', distanceLY: 197, diameterSolar: 14.0, color: '#FFD700', constellation: 'ã‚¢ãƒ³ãƒ‰ãƒ­ãƒ¡ãƒ€åº§Î²æ˜Ÿ', azimuth: 10 },
			{ name: 'ã‚¢ãƒ«ãƒ‹ãƒ©ãƒ ', distanceLY: 2000, diameterSolar: 42.0, color: '#B8D8FF', constellation: 'ã‚ªãƒªã‚ªãƒ³åº§Îµæ˜Ÿ', azimuth: 135 },
			{ name: 'ã‚¢ãƒ«ãƒ‹ã‚¿ã‚¯', distanceLY: 1260, diameterSolar: 20.0, color: '#C0D8FF', constellation: 'ã‚ªãƒªã‚ªãƒ³åº§Î¶æ˜Ÿ', azimuth: 130 },
			{ name: 'ãƒŸãƒ³ã‚¿ã‚«', distanceLY: 1200, diameterSolar: 16.5, color: '#C0E0FF', constellation: 'ã‚ªãƒªã‚ªãƒ³åº§Î´æ˜Ÿ', azimuth: 125 },
			{ name: 'ãƒ™ãƒ©ãƒˆãƒªãƒƒã‚¯ã‚¹', distanceLY: 243, diameterSolar: 5.8, color: '#F0F8FF', constellation: 'ã‚ªãƒªã‚ªãƒ³åº§Î³æ˜Ÿ', azimuth: 145 },
			{ name: 'ã‚µã‚¤ãƒ•', distanceLY: 650, diameterSolar: 14.0, color: '#B8D8FF', constellation: 'ã‚ªãƒªã‚ªãƒ³åº§Îºæ˜Ÿ', azimuth: 155 },
			{ name: 'ãƒãƒ©ãƒªã‚¹(åŒ—æ¥µæ˜Ÿ)', distanceLY: 433, diameterSolar: 37.5, color: '#FFFACD', constellation: 'ã“ãã¾åº§Î±æ˜Ÿ', azimuth: 0 },
			{ name: 'ãƒ‡ãƒãƒœãƒ©', distanceLY: 36, diameterSolar: 1.7, color: '#F5F8FF', constellation: 'ã—ã—åº§Î²æ˜Ÿ', azimuth: 210 },
			{ name: 'ãƒŸã‚¶ãƒ¼ãƒ«', distanceLY: 82.9, diameterSolar: 2.4, color: '#F8F8FF', constellation: 'ãŠãŠãã¾åº§Î¶æ˜Ÿ', azimuth: 350 },
			{ name: 'ã‚¢ãƒ«ãƒ•ã‚§ãƒ©ãƒƒãƒ„', distanceLY: 97, diameterSolar: 2.7, color: '#E8F0FF', constellation: 'ã‚¢ãƒ³ãƒ‰ãƒ­ãƒ¡ãƒ€åº§Î±æ˜Ÿ', azimuth: 20 },
			{ name: 'ãƒ„ãƒãƒ¼ãƒ³', distanceLY: 303, diameterSolar: 40.0, color: '#FFFACD', constellation: 'ã‚Šã‚…ã†åº§Î±æ˜Ÿ', azimuth: 360 }
		];

		// ========== ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•° ==========
		let map;
		let sunMarker;
		let sunCoordinates = INITIAL_CENTER;

		// åœ°å›³ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©
		const MAP_STYLES = {
			'osm': {
				version: 8,
				glyphs: 'https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf',
				sources: {
					'osm': {
						type: 'raster',
						tiles: [
							'https://a.tile.openstreetmap.org/{z}/{x}/{y}.png',
							'https://b.tile.openstreetmap.org/{z}/{x}/{y}.png',
							'https://c.tile.openstreetmap.org/{z}/{x}/{y}.png'
						],
						tileSize: 256,
						attribution: 'Â© OpenStreetMap contributors'
					}
				},
				layers: [{
					id: 'osm',
					type: 'raster',
					source: 'osm',
					minzoom: 0,
					maxzoom: 19
				}]
			},
			'gsi-std': {
				version: 8,
				glyphs: 'https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf',
				sources: {
					'gsi-std': {
						type: 'raster',
						tiles: [
							'https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png'
						],
						tileSize: 256,
						attribution: '<a href="https://maps.gsi.go.jp/development/ichiran.html" target="_blank">åœ°ç†é™¢ã‚¿ã‚¤ãƒ«</a>'
					}
				},
				layers: [{
					id: 'gsi-std',
					type: 'raster',
					source: 'gsi-std',
					minzoom: 0,
					maxzoom: 18
				}]
			},
			'gsi-pale': {
				version: 8,
				glyphs: 'https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf',
				sources: {
					'gsi-pale': {
						type: 'raster',
						tiles: [
							'https://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png'
						],
						tileSize: 256,
						attribution: '<a href="https://maps.gsi.go.jp/development/ichiran.html" target="_blank">åœ°ç†é™¢ã‚¿ã‚¤ãƒ«</a>'
					}
				},
				layers: [{
					id: 'gsi-pale',
					type: 'raster',
					source: 'gsi-pale',
					minzoom: 0,
					maxzoom: 18
				}]
			},
			'gsi-blank': {
				version: 8,
				glyphs: 'https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf',
				sources: {
					'gsi-blank': {
						type: 'raster',
						tiles: [
							'https://cyberjapandata.gsi.go.jp/xyz/blank/{z}/{x}/{y}.png'
						],
						tileSize: 256,
						attribution: '<a href="https://maps.gsi.go.jp/development/ichiran.html" target="_blank">åœ°ç†é™¢ã‚¿ã‚¤ãƒ«</a>'
					}
				},
				layers: [{
					id: 'gsi-blank-layer',
					type: 'raster',
					source: 'gsi-blank',
					minzoom: 0,
					maxzoom: 14
				}]
			},
			'gsi-photo': {
				version: 8,
				glyphs: 'https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf',
				sources: {
					'gsi-photo': {
						type: 'raster',
						tiles: [
							'https://cyberjapandata.gsi.go.jp/xyz/seamlessphoto/{z}/{x}/{y}.jpg'
						],
						tileSize: 256,
						attribution: '<a href="https://maps.gsi.go.jp/development/ichiran.html" target="_blank">åœ°ç†é™¢ã‚¿ã‚¤ãƒ«</a>'
					}
				},
				layers: [{
					id: 'gsi-photo',
					type: 'raster',
					source: 'gsi-photo',
					minzoom: 0,
					maxzoom: 18
				}]
			}
		};

		// ========== åˆ°é”æ™‚é–“ã®è¨ˆç®— ==========
		function calculateTravelTime(distanceLY) {
			const distanceKm = distanceLY * LIGHT_YEAR_IN_KM;
			const LIGHT_SPEED_KM_S = 299792.458; // å…‰é€Ÿ km/s
			const VOYAGER_SPEED_KM_S = 17; // ãƒœã‚¤ã‚¸ãƒ£ãƒ¼1å·ã®é€Ÿåº¦ km/s
			const LIGHT_SPEED_1_PERCENT = LIGHT_SPEED_KM_S * 0.01;
			const LIGHT_SPEED_10_PERCENT = LIGHT_SPEED_KM_S * 0.10;

			// å…‰é€Ÿã§ã®æ™‚é–“
			const lightSeconds = distanceKm / LIGHT_SPEED_KM_S;
			let lightTime = formatTime(lightSeconds);

			// ãƒœã‚¤ã‚¸ãƒ£ãƒ¼1å·ã§ã®æ™‚é–“
			const voyagerSeconds = distanceKm / VOYAGER_SPEED_KM_S;
			let voyagerTime = formatTime(voyagerSeconds);

			// å…‰é€Ÿ1%ã§ã®æ™‚é–“
			const speed1PercentSeconds = distanceKm / LIGHT_SPEED_1_PERCENT;
			let speed1PercentTime = formatTime(speed1PercentSeconds);

			// å…‰é€Ÿ10%ã§ã®æ™‚é–“
			const speed10PercentSeconds = distanceKm / LIGHT_SPEED_10_PERCENT;
			let speed10PercentTime = formatTime(speed10PercentSeconds);

			return {
				light: lightTime,
				voyager: voyagerTime,
				speed1Percent: speed1PercentTime,
				speed10Percent: speed10PercentTime
			};
		}

		function formatTime(seconds) {
			if (seconds < 60) {
				return `${seconds.toFixed(2)}ç§’`;
			} else if (seconds < 3600) {
				return `${(seconds / 60).toFixed(2)}åˆ†`;
			} else if (seconds < 86400) {
				return `${(seconds / 3600).toFixed(2)}æ™‚é–“`;
			} else if (seconds < 31536000) {
				return `${(seconds / 86400).toFixed(2)}æ—¥`;
			} else {
				return `${(seconds / 31536000).toFixed(2)}å¹´`;
			}
		}

		// ========== åˆæœŸåŒ– ==========
		function init() {
			// åœ°å›³ã®åˆæœŸåŒ–
			map = new maplibregl.Map({
				container: 'map',
				style: MAP_STYLES['osm'],
				center: INITIAL_CENTER,
				zoom: 10
			});

			// åœ°å›³ã®èª­ã¿è¾¼ã¿å®Œäº†å¾Œ
			map.on('load', () => {
				// å¤ªé™½ãƒãƒ¼ã‚«ãƒ¼ã®ä½œæˆ
				createSunMarker();

				// åˆæœŸæç”»
				updateStars();

				// å‡¡ä¾‹ã®åˆæœŸåŒ–
				updateLegend();
			});

			// Enterã‚­ãƒ¼ã§æç”»æ›´æ–°
			document.getElementById('scaleKm').addEventListener('keypress', (e) => {
				if (e.key === 'Enter') updateStars();
			});
		}

		// ========== å¤ªé™½ãƒãƒ¼ã‚«ãƒ¼ã®ä½œæˆ ==========
		function createSunMarker() {
			// ã‚«ã‚¹ã‚¿ãƒ ãƒãƒ¼ã‚«ãƒ¼è¦ç´ ã®ä½œæˆ
			const el = document.createElement('div');
			el.style.width = '30px';
			el.style.height = '30px';
			el.style.borderRadius = '50%';
			el.style.background = 'radial-gradient(circle, #FFD700, #FFA500)';
			el.style.border = '3px solid white';
			el.style.boxShadow = '0 0 15px rgba(255, 165, 0, 0.7)';
			el.style.cursor = 'move';

			// ãƒãƒ¼ã‚«ãƒ¼ã®ä½œæˆ
			sunMarker = new maplibregl.Marker({
				element: el,
				draggable: true
			})
				.setLngLat(sunCoordinates)
				.addTo(map);

			// ãƒ‰ãƒ©ãƒƒã‚°çµ‚äº†æ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆ
			sunMarker.on('dragend', () => {
				sunCoordinates = sunMarker.getLngLat().toArray();
				updateStars();
			});
		}

		// ========== IDã‚’å®‰å…¨ãªæ–‡å­—åˆ—ã«å¤‰æ› ==========
		function sanitizeId(name) {
			return name.replace(/[()ï¼ˆï¼‰]/g, '').replace(/\s+/g, '-');
		}

		// ========== ãƒ—ãƒªã‚»ãƒƒãƒˆè¨­å®š ==========
		function setPreset(kmPerLY) {
			document.getElementById('scaleKm').value = kmPerLY;
			updateStars();
		}

		// ========== æ’æ˜Ÿã®æ›´æ–°ãƒ»æç”» ==========
		function updateStars() {
			const scaleKm = parseFloat(document.getElementById('scaleKm').value);

			if (isNaN(scaleKm) || scaleKm <= 0) {
				alert('æœ‰åŠ¹ãªç¸®å°ºã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
				return;
			}

			console.log(`ç¸®å°º: 1å…‰å¹´ = ${scaleKm} km`);

			// ç¯„å›²å¤–ã®æ’æ˜Ÿãƒªã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢
			window.outOfRangeStars = [];

			// æ—¢å­˜ã®æ’æ˜Ÿãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤
			STARS.forEach(star => {
				const safeName = sanitizeId(star.name);
				const lineLayerId = `line-${safeName}`;
				const lineSourceId = `line-source-${safeName}`;
				const starLayerId = `star-${safeName}`;
				const starSourceId = `star-source-${safeName}`;
				const labelLayerId = `label-${safeName}`;
				const labelSourceId = `label-source-${safeName}`;

				if (map.getLayer(lineLayerId)) map.removeLayer(lineLayerId);
				if (map.getSource(lineSourceId)) map.removeSource(lineSourceId);
				if (map.getLayer(starLayerId)) map.removeLayer(starLayerId);
				if (map.getSource(starSourceId)) map.removeSource(starSourceId);
				if (map.getLayer(labelLayerId)) map.removeLayer(labelLayerId);
				if (map.getSource(labelSourceId)) map.removeSource(labelSourceId);
			});

			// å„æ’æ˜Ÿã‚’æç”»
			STARS.forEach(star => {
				const safeName = sanitizeId(star.name);
				// åœ°å›³ä¸Šã§ã®è·é›¢(km)
				const distanceKm = star.distanceLY * scaleKm;

				// è·é›¢ãŒ20,000kmã‚’è¶…ãˆã‚‹å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
				if (distanceKm > 20000) {
					const japanLength = 3000; // æ—¥æœ¬åˆ—å³¶ã®é•·ã•(ç´„3000km)
					const timesJapan = distanceKm / japanLength;
					console.log(`${star.name}: ${distanceKm.toFixed(2)} km (æ—¥æœ¬åˆ—å³¶${timesJapan.toFixed(2)}å€‹åˆ†) - è¡¨ç¤ºç¯„å›²å¤–ã®ãŸã‚ã‚¹ã‚­ãƒƒãƒ—`);

					window.outOfRangeStars.push({
						name: star.name,
						color: star.color,
						constellation: star.constellation,
						distanceKm: distanceKm,
						timesJapan: timesJapan,
						distanceLY: star.distanceLY
					});

					return;
				}

				// æ’æ˜Ÿã®ä½ç½®ã‚’è¨ˆç®—
				const starPosition = turf.destination(sunCoordinates, distanceKm, star.azimuth, { units: 'kilometers' });

				// è·é›¢ç·šã‚’ç”Ÿæˆ
				const lineFeature = turf.lineString([sunCoordinates, starPosition.geometry.coordinates]);

				const lineSourceId = `line-source-${safeName}`;
				const lineLayerId = `line-${safeName}`;

				// è·é›¢ç·šã®ã‚½ãƒ¼ã‚¹ã¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¿½åŠ 
				map.addSource(lineSourceId, {
					type: 'geojson',
					data: lineFeature
				});

				map.addLayer({
					id: lineLayerId,
					type: 'line',
					source: lineSourceId,
					paint: {
						'line-color': star.color,
						'line-width': 3,
						'line-opacity': 0.6
					}
				});

				// è·é›¢ç·šã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
				map.on('click', lineLayerId, (e) => {
					showStarPopup(star, e.lngLat, distanceKm);
				});

				map.on('mouseenter', lineLayerId, () => {
					map.getCanvas().style.cursor = 'pointer';
				});

				map.on('mouseleave', lineLayerId, () => {
					map.getCanvas().style.cursor = '';
				});

				// æ’æ˜Ÿã®ãƒãƒ¼ã‚«ãƒ¼ã‚’ä½œæˆ
				const starSourceId = `star-source-${safeName}`;
				const starLayerId = `star-${safeName}`;

				const starPoint = turf.point(starPosition.geometry.coordinates); map.addSource(starSourceId, {
					type: 'geojson',
					data: starPoint
				});

				map.addLayer({
					id: starLayerId,
					type: 'circle',
					source: starSourceId,
					paint: {
						'circle-radius': 8,
						'circle-color': star.color,
						'circle-opacity': 0.9,
						'circle-stroke-width': 2,
						'circle-stroke-color': '#ffffff'
					}
				});

				// æ’æ˜Ÿãƒãƒ¼ã‚«ãƒ¼ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
				map.on('click', starLayerId, (e) => {
					showStarPopup(star, e.lngLat, distanceKm);
				});

				map.on('mouseenter', starLayerId, () => {
					map.getCanvas().style.cursor = 'pointer';
				});

				map.on('mouseleave', starLayerId, () => {
					map.getCanvas().style.cursor = '';
				});

				// æ’æ˜Ÿåãƒ©ãƒ™ãƒ«ã®è¿½åŠ 
				const labelSourceId = `label-source-${safeName}`;
				const labelLayerId = `label-${safeName}`;

				const labelPoint = turf.point(starPosition.geometry.coordinates, {
					name: star.name
				}); map.addSource(labelSourceId, {
					type: 'geojson',
					data: labelPoint
				});

				map.addLayer({
					id: labelLayerId,
					type: 'symbol',
					source: labelSourceId,
					layout: {
						'text-field': ['get', 'name'],
						'text-font': ['Open Sans Bold', 'Arial Unicode MS Bold'],
						'text-size': 14,
						'text-offset': [0, -1.5],
						'text-anchor': 'bottom',
						'text-allow-overlap': true,
						'text-ignore-placement': true
					},
					paint: {
						'text-color': star.color,
						'text-halo-color': '#000000',
						'text-halo-width': 2
					}
				}); console.log(`${star.name}: ${distanceKm.toFixed(2)} km`);
			});

			// ç¯„å›²å¤–ã®æ’æ˜Ÿãƒªã‚¹ãƒˆã‚’æ›´æ–°
			updateOutOfRangeList();
		}

		// ========== æ’æ˜Ÿã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤º ==========
		function showStarPopup(star, coordinates, distanceKm) {
			const travelTime = calculateTravelTime(star.distanceLY);

			const popupContent = `
				<div style="font-family: 'Segoe UI', sans-serif; min-width: 280px;">
					<h3 style="margin: 0 0 10px 0; color: ${star.color}; font-size: 16px;">
						${star.name}
					</h3>
					<div style="font-size: 13px; line-height: 1.6;">
						<p style="margin: 5px 0;"><strong>æ˜Ÿåº§:</strong> ${star.constellation}</p>
						<p style="margin: 5px 0;"><strong>å¤ªé™½ã‹ã‚‰ã®è·é›¢:</strong> ${star.distanceLY.toFixed(2)} å…‰å¹´</p>
						<p style="margin: 5px 0;"><strong>åœ°å›³ä¸Šã®è·é›¢:</strong> ${distanceKm.toFixed(2)} km</p>
						<p style="margin: 5px 0;"><strong>ç›´å¾„(å¤ªé™½æ¯”):</strong> ${star.diameterSolar}å€</p>
						<hr style="margin: 10px 0; border: none; border-top: 1px solid #ddd;">
						<p style="margin: 5px 0; font-weight: bold; color: #333;">ğŸš€ åˆ°é”æ™‚é–“:</p>
						<p style="margin: 3px 0 3px 15px;">ğŸ’¡ å…‰é€Ÿ: <strong>${travelTime.light}</strong></p>
						<p style="margin: 3px 0 3px 15px;">ğŸ›¸ ãƒœã‚¤ã‚¸ãƒ£ãƒ¼1å·: <strong>${travelTime.voyager}</strong></p>
						<p style="margin: 3px 0 3px 15px;">âš¡ å…‰é€Ÿ1%: <strong>${travelTime.speed1Percent}</strong></p>
						<p style="margin: 3px 0 3px 15px;">âš¡ å…‰é€Ÿ10%: <strong>${travelTime.speed10Percent}</strong></p>
						<hr style="margin: 10px 0; border: none; border-top: 1px solid #ddd;">
						<p style="margin: 5px 0;">
							<a href="https://www.google.com/maps?q=${coordinates.lat},${coordinates.lng}" 
							   target="_blank" 
							   style="color: #4CAF50; text-decoration: none;">
								ğŸ“ Google Mapsã§ã“ã®å ´æ‰€ã‚’è¦‹ã‚‹
							</a>
						</p>
					</div>
				</div>
			`;

			new maplibregl.Popup({
				maxWidth: '350px'
			})
				.setLngLat(coordinates)
				.setHTML(popupContent)
				.addTo(map);
		}

		// ========== æç”»ç¯„å›²å¤–ã®æ’æ˜Ÿãƒªã‚¹ãƒˆã‚’æ›´æ–° ==========
		function updateOutOfRangeList() {
			const listElement = document.getElementById('outOfRangeList');

			if (!window.outOfRangeStars || window.outOfRangeStars.length === 0) {
				listElement.innerHTML = '<div class="out-of-range-empty">ã™ã¹ã¦ã®æ’æ˜ŸãŒè¡¨ç¤ºç¯„å›²å†…ã§ã™</div>';
				return;
			}

			let html = '';
			window.outOfRangeStars.forEach(star => {
				html += `<div class="out-of-range-item" style="border-left-color: ${star.color};">`;
				html += `<strong>${star.name}</strong> (${star.constellation})<br>`;
				html += `å®Ÿè·é›¢: ${star.distanceLY.toFixed(2)} å…‰å¹´<br>`;
				html += `åœ°å›³ä¸Š: ${star.distanceKm.toLocaleString('ja-JP', { maximumFractionDigits: 0 })} km<br>`;
				html += `æ—¥æœ¬åˆ—å³¶ <strong>${star.timesJapan.toFixed(1)}</strong> å€‹åˆ†`;
				html += `</div>`;
			});

			listElement.innerHTML = html;
		}

		// ========== å‡¡ä¾‹ã®æ›´æ–° ==========
		function updateLegend() {
			const legendList = document.getElementById('legendList');
			let html = '';

			STARS.forEach(star => {
				html += `<div class="legend-item">`;
				html += `<div class="legend-color" style="background-color: ${star.color};"></div>`;
				html += `<span>${star.name} (${star.distanceLY.toFixed(1)} å…‰å¹´)</span>`;
				html += `</div>`;
			});

			legendList.innerHTML = html;
		}

		// ========== åœ°å›³ã‚¹ã‚¿ã‚¤ãƒ«åˆ‡ã‚Šæ›¿ãˆ ==========
		function changeMapStyle() {
			const selectedStyle = document.getElementById('mapStyle').value;

			// ç¾åœ¨ã®ä¸­å¿ƒåº§æ¨™ã¨ã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«ã‚’ä¿å­˜
			const currentCenter = map.getCenter();
			const currentZoom = map.getZoom();
			const currentSunCoords = sunCoordinates;

			// åœ°å›³ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å¤‰æ›´
			map.setStyle(MAP_STYLES[selectedStyle]);

			// ã‚¹ã‚¿ã‚¤ãƒ«èª­ã¿è¾¼ã¿å®Œäº†å¾Œã«æ’æ˜Ÿã‚’å†æç”»
			map.once('styledata', () => {
				// ä¸­å¿ƒåº§æ¨™ã¨ã‚ºãƒ¼ãƒ ã‚’å¾©å…ƒ
				map.setCenter(currentCenter);
				map.setZoom(currentZoom);

				// å¤ªé™½ã®ä½ç½®ã‚’å¾©å…ƒ
				sunCoordinates = currentSunCoords;
				if (sunMarker) {
					sunMarker.setLngLat(sunCoordinates);
				}

				// æ’æ˜Ÿã‚’å†æç”»
				updateStars();
			});
		}

		// ========== å…¨ç”»é¢ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ ==========
		function toggleFullscreen() {
			if (!document.fullscreenElement) {
				document.documentElement.requestFullscreen().catch(err => {
					alert(`å…¨ç”»é¢ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆã§ãã¾ã›ã‚“ã§ã—ãŸ: ${err.message}`);
				});
			} else {
				if (document.exitFullscreen) {
					document.exitFullscreen();
				}
			}
		}

		// å…¨ç”»é¢ãƒ¢ãƒ¼ãƒ‰ã®å¤‰åŒ–ã‚’ç›£è¦–
		document.addEventListener('fullscreenchange', () => {
			const btn = document.querySelector('.fullscreen-btn');
			if (document.fullscreenElement) {
				btn.textContent = 'âŒ';
				btn.title = 'å…¨ç”»é¢ãƒ¢ãƒ¼ãƒ‰ã‚’çµ‚äº†';
			} else {
				btn.textContent = 'â›¶';
				btn.title = 'å…¨ç”»é¢ãƒ¢ãƒ¼ãƒ‰';
			}
		});

		// ========== ãƒ‘ãƒãƒ«ã®æŠ˜ã‚ŠãŸãŸã¿ ==========
		function togglePanel(contentId) {
			const content = document.getElementById(contentId);
			const button = event.target;

			if (content.classList.contains('collapsed')) {
				content.classList.remove('collapsed');
				content.style.maxHeight = content.scrollHeight + 'px';
				button.textContent = 'â–¼';
			} else {
				content.style.maxHeight = content.scrollHeight + 'px';
				setTimeout(() => {
					content.classList.add('collapsed');
				}, 10);
				button.textContent = 'â–¶';
			}
		}

		// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å„ãƒ‘ãƒãƒ«ã®åˆæœŸmaxHeightã‚’è¨­å®š
		window.addEventListener('load', () => {
			init();

			// å„ãƒ‘ãƒãƒ«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åˆæœŸmaxHeightã‚’è¨­å®š
			['controlContent', 'outOfRangeContent', 'legendContent'].forEach(id => {
				const element = document.getElementById(id);
				if (element) {
					element.style.maxHeight = element.scrollHeight + 'px';
				}
			});
		});
	</script>
</body>

</html>
![1765362660629](image/銀河系距離シミュレーター仕様書/1765362660629.png)# 銀河系距離シミュレーター 仕様書

## 1. 概要

### 1.1 プロジェクト名
**銀河系大きさ体感マップ (Galactic Distance Simulator)**

### 1.2 目的
銀河系の大きさと、銀河系から他の銀河までの距離を地図上で視覚化し、宇宙空間のスケール感を体感できるインタラクティブなWebアプリケーションを提供する。

### 1.3 コンセプト
- 太陽系大きさ体感マップと同じく、MapLibre GL JSを使用した地図ベースのインタラクティブビジュアライゼーション
- 銀河系の直径を実世界のスケール（例: 100km、1000kmなど）に縮小して表示
- 縮小した縮尺で、アンドロメダ銀河、大マゼラン雲などの近傍銀河までの距離を地図上に円で表示
- ユーザーが銀河系の大きさを変更することで、宇宙の広大さを実感

---

## 2. 技術スタック

### 2.1 使用ライブラリ
- **MapLibre GL JS 5.0.0**: 地図表示エンジン
- **Turf.js 6.5.0**: 地理空間計算（円の生成など）
- **Vanilla JavaScript**: フロントエンド実装

### 2.2 地図ソース
- OpenStreetMap
- 地理院地図（標準、淡色、白地図、衛星写真）

### 2.3 開発環境
- 単一HTMLファイル（スタンドアロン）
- CDN経由でライブラリを読み込み
- レスポンシブデザイン対応

---

## 3. 機能仕様

### 3.1 コアメカニクス

#### 3.1.1 縮尺計算システム
```
縮尺係数 = 入力された銀河系の直径(km) / 銀河系の実際の直径(光年をkmに変換)
他銀河までの距離(地図上のkm) = 実際の距離(光年) × 光年あたりのkm × 縮尺係数
```

#### 3.1.2 基準となる銀河系データ
- **銀河系の直径**: 約105,700光年（公称値）
- **銀河系の厚さ**: 約1,000光年（ディスク部分）
- **1光年**: 9.461兆km (9,460,730,472,580.8 km)

#### 3.1.3 表示対象の銀河・天体

| 天体名                | 距離（光年） | 種別     | 色      | 備考                   |
| --------------------- | ------------ | -------- | ------- | ---------------------- |
| 銀河系中心            | 0            | 基準点   | #FFD700 | ドラッグ可能なマーカー |
| 大マゼラン雲          | 163,000      | 矮小銀河 | #FF6B9D | 銀河系の伴銀河         |
| 小マゼラン雲          | 200,000      | 矮小銀河 | #9D6BFF | 銀河系の伴銀河         |
| アンドロメダ銀河(M31) | 2,537,000    | 渦巻銀河 | #00CED1 | 局所銀河群最大         |
| さんかく座銀河(M33)   | 2,730,000    | 渦巻銀河 | #FF8C00 | 局所銀河群第3位        |
| ケンタウルス座A       | 13,700,000   | 楕円銀河 | #DC143C | 最も近い活動銀河       |
| おとめ座銀河団中心    | 53,500,000   | 銀河団   | #9370DB | 局所超銀河団の中心     |
| かみのけ座銀河団      | 320,000,000  | 銀河団   | #4682B4 | 観測可能な遠方銀河団   |
| おおぐま座銀河団      | 390,000,000  | 銀河団   | #2E8B57 | グレートウォールの一部 |

### 3.2 ユーザーインターフェース

#### 3.2.1 コントロールパネル（左上）
- **パネルタイトル**: 「🌌 銀河系大きさ体感マップ」
- **地図スタイル選択**: ドロップダウンメニュー
  - OpenStreetMap
  - 地理院地図（標準、淡色、白地図、衛星写真）
- **銀河系の直径入力**: 数値入力フィールド
  - 単位: km
  - デフォルト値: 100 km
  - 最小値: 1 km
  - ステップ: 1 km
- **描画更新ボタン**: 入力値を反映して再描画
- **情報テキスト**: 「銀河系マーカーをドラッグして位置を変更できます」
- **折りたたみ機能**: パネル右上にトグルボタン

#### 3.2.2 凡例パネル（右下）
- 各銀河・天体の名前と色を表示
- 距離（光年）を併記
- 種別アイコンまたは記号を追加
- 折りたたみ機能

#### 3.2.3 描画範囲外パネル（右上）
- 地図の表示範囲を超える銀河のリスト
- 各銀河の情報:
  - 名前
  - 距離（km）
  - 地球周長の何倍か
- 範囲内にすべて収まっている場合: 「すべての銀河が表示範囲内です」
- 折りたたみ機能

#### 3.2.4 全画面ボタン（左下）
- 地図を全画面表示に切り替え
- アイコン: ⛶ / ❌

### 3.3 地図表示機能

#### 3.3.1 銀河系マーカー
- 中心位置: 初期値は和歌山県 四季の郷公園（経度135.2597718, 緯度34.2161407）
- ビジュアル:
  - 円形マーカー（直径40px）
  - 背景: 放射状グラデーション（中心: #FFD700、外側: #FFA500）
  - 白い枠線（3px）
  - ボックスシャドウで発光効果
- ドラッグ可能
- ドラッグ終了時に自動的に銀河の軌道を再描画

#### 3.3.2 銀河までの距離円
- Turf.jsで生成した円形のGeoJSON
- 線の太さ:
  - 矮小銀河: 3px
  - 渦巻銀河/楕円銀河: 4px
  - 銀河団: 5px
- 線の透明度:
  - 近傍銀河（1000万光年以内）: 0.7
  - 遠方銀河: 0.5
- 線のスタイル:
  - 矮小銀河: 実線
  - 渦巻銀河/楕円銀河: 実線
  - 銀河団: 破線 [10, 10]

#### 3.3.3 銀河本体の表示
- 銀河系: 塗りつぶし円（半径を縮尺計算）
  - 色: #FFD700、透明度: 0.4
- 他銀河: オプション（実装可能）
  - アンドロメダ銀河など主要銀河の直径を円で表示
  - 色: 各銀河の指定色、透明度: 0.6

#### 3.3.4 ラベル表示
- 各距離円上に銀河名をラベル表示
- テキストサイズ:
  - 矮小銀河: 16px
  - 渦巻銀河/楕円銀河: 18px
  - 銀河団: 20px
- テキストカラー: 各銀河の指定色
- ハロー効果: 白色、幅3px
- 配置: 距離円の右側（90度の位置）、上部に配置

### 3.4 インタラクション

#### 3.4.1 クリック時のポップアップ
距離円または銀河本体をクリックすると、詳細情報をポップアップ表示:

**表示内容:**
- 銀河名（見出し、銀河の色で表示）
- 距離: ○○○万光年
- 実際の距離: ○○兆km
- 区切り線
- 🚀 **光の到達時間:**
  - 💡 光速: ○○年
  - （補足: 光速での移動時間）
- 🔭 **観測情報:**
  - 種別: 矮小銀河 / 渦巻銀河 / 楕円銀河 / 銀河団
  - 発見年: ○○○○年（オプション）
- 区切り線
- 📍 Google Mapsでこの場所を見る（リンク）

#### 3.4.2 マウスホバー
- 距離円または銀河本体にホバー時、カーソルがポインターに変化

#### 3.4.3 銀河系マーカーのドラッグ
- マーカーをドラッグして銀河系の中心位置を変更
- ドラッグ終了時に自動的にすべての距離円を再描画

### 3.5 描画範囲制限

#### 3.5.1 描画範囲の上限
- 距離円の半径が **20,000 km** を超える場合は描画をスキップ
- スキップした銀河は「描画範囲外パネル」に表示

#### 3.5.2 範囲外銀河の情報
- 銀河名
- 距離（km）
- 地球赤道周長（約40,075 km）の何倍か

---

## 4. データ構造

### 4.1 定数定義

```javascript
// 銀河系の実際の直径（光年）
const MILKY_WAY_DIAMETER_LY = 105700;

// 1光年（km）
const LIGHT_YEAR_IN_KM = 9460730472580.8;

// 地球の赤道周長（km）
const EARTH_CIRCUMFERENCE_KM = 40075;

// 銀河データ配列
const GALAXIES = [
  { 
    name: '大マゼラン雲', 
    distanceLY: 163000, 
    diameterLY: 14000, 
    color: '#FF6B9D', 
    type: 'dwarf',
    discoveryYear: null // 古代から可視
  },
  { 
    name: '小マゼラン雲', 
    distanceLY: 200000, 
    diameterLY: 7000, 
    color: '#9D6BFF', 
    type: 'dwarf',
    discoveryYear: null
  },
  { 
    name: 'アンドロメダ銀河', 
    distanceLY: 2537000, 
    diameterLY: 220000, 
    color: '#00CED1', 
    type: 'spiral',
    discoveryYear: 964
  },
  { 
    name: 'さんかく座銀河', 
    distanceLY: 2730000, 
    diameterLY: 60000, 
    color: '#FF8C00', 
    type: 'spiral',
    discoveryYear: 1784
  },
  { 
    name: 'ケンタウルス座A', 
    distanceLY: 13700000, 
    diameterLY: 60000, 
    color: '#DC143C', 
    type: 'elliptical',
    discoveryYear: 1826
  },
  { 
    name: 'おとめ座銀河団', 
    distanceLY: 53500000, 
    diameterLY: 0, 
    color: '#9370DB', 
    type: 'cluster',
    discoveryYear: 1781
  },
  { 
    name: 'かみのけ座銀河団', 
    distanceLY: 320000000, 
    diameterLY: 0, 
    color: '#4682B4', 
    type: 'cluster',
    discoveryYear: 1785
  },
  { 
    name: 'おおぐま座銀河団', 
    distanceLY: 390000000, 
    diameterLY: 0, 
    color: '#2E8B57', 
    type: 'cluster',
    discoveryYear: 1900
  }
];
```

### 4.2 種別の定義

- **dwarf**: 矮小銀河
- **spiral**: 渦巻銀河
- **elliptical**: 楕円銀河
- **cluster**: 銀河団

---

## 5. 計算ロジック

### 5.1 縮尺係数の計算

```javascript
// ユーザーが入力した銀河系の直径（km）
const inputMilkyWayDiameterKm = parseFloat(document.getElementById('milkyWayDiameter').value);

// 銀河系の実際の直径（km）
const actualMilkyWayDiameterKm = MILKY_WAY_DIAMETER_LY * LIGHT_YEAR_IN_KM;

// 縮尺係数
const scale = inputMilkyWayDiameterKm / actualMilkyWayDiameterKm;
```

### 5.2 銀河までの距離（地図上のkm）

```javascript
// 銀河までの実際の距離（km）
const actualDistanceKm = galaxy.distanceLY * LIGHT_YEAR_IN_KM;

// 地図上での距離（km）
const mapDistanceKm = actualDistanceKm * scale;
```

### 5.3 銀河の直径（地図上のkm）

```javascript
// 銀河の実際の直径（km）
const actualGalaxyDiameterKm = galaxy.diameterLY * LIGHT_YEAR_IN_KM;

// 地図上での直径（km）
const mapGalaxyDiameterKm = actualGalaxyDiameterKm * scale;

// 半径（km）
const mapGalaxyRadiusKm = mapGalaxyDiameterKm / 2;
```

### 5.4 光の到達時間の計算

```javascript
function calculateLightTravelTime(distanceLY) {
  if (distanceLY < 1) {
    return `${(distanceLY * 365.25).toFixed(2)}日`;
  } else if (distanceLY < 1000) {
    return `${distanceLY.toFixed(2)}年`;
  } else if (distanceLY < 1000000) {
    return `${(distanceLY / 1000).toFixed(2)}千年`;
  } else if (distanceLY < 1000000000) {
    return `${(distanceLY / 1000000).toFixed(2)}百万年`;
  } else {
    return `${(distanceLY / 1000000000).toFixed(2)}億年`;
  }
}
```

---

## 6. UIデザイン仕様

### 6.1 カラースキーム
- **背景**: 地図（ユーザー選択）
- **コントロールパネル**: 白背景、影付き
- **ボタン**: 緑系（#4CAF50）
- **テキスト**: ダークグレー（#333）
- **ボーダー**: ライトグレー（#ddd）

### 6.2 レスポンシブ対応
- モバイル: コントロールパネルを画面上部に配置、幅100%
- タブレット: 通常通り左上配置
- デスクトップ: 通常通り左上配置

### 6.3 アニメーション
- パネル折りたたみ: 0.3秒のスムーズなトランジション
- ホバーエフェクト: 0.3秒のカラートランジション

---

## 7. パフォーマンス最適化

### 7.1 描画の最適化
- 距離円の半径が20,000 kmを超える場合は描画をスキップ
- GeoJSON生成時の円の分割数を調整（steps: 64-128）

### 7.2 イベント処理
- マーカードラッグ時は`dragend`イベントで再描画（リアルタイム更新は行わない）
- 地図スタイル変更時は既存データを保存して復元

---

## 8. 拡張機能（オプション）

### 8.1 アニメーション機能
- 光が銀河系から他銀河に向かって進む様子をアニメーション表示
- 距離円を段階的に拡大していくエフェクト

### 8.2 比較モード
- 複数の縮尺を同時に表示（画面分割）
- 縮尺の違いによる距離感の変化を比較

### 8.3 3D表示
- MapLibre GL JSの3D機能を使用
- 銀河の厚さを高さで表現

### 8.4 時間軸の追加
- 光の速度で移動した場合の経過時間を視覚化
- タイムスライダーで「現在光が到達している位置」を表示

### 8.5 クイズモード
- ランダムに銀河を選択し、距離を当てるゲーム
- 正解との誤差を表示

### 8.6 データ追加
- より多くの銀河・銀河団を追加
- 超銀河団、宇宙の大規模構造（グレートウォールなど）

---

## 9. ファイル構成

```
galaxy-distance-map.html    # メインHTMLファイル（単一ファイル）
├── <head>
│   ├── メタ情報（タイトル、説明、OGP）
│   ├── Google Analytics
│   ├── MapLibre GL JS（CDN）
│   ├── Turf.js（CDN）
│   └── <style>（CSS）
└── <body>
    ├── <div id="map">（地図コンテナ）
    ├── 全画面ボタン
    ├── コントロールパネル
    ├── 描画範囲外パネル
    ├── 凡例パネル
    └── <script>（JavaScript）
        ├── 定数定義
        ├── グローバル変数
        ├── 初期化関数
        ├── 銀河系マーカー作成
        ├── 距離円描画・更新
        ├── イベントハンドラ
        └── ユーティリティ関数
```

---

## 10. 実装の優先順位

### Phase 1: 基本機能（MVP）
- [x] 地図表示（MapLibre GL JS）
- [x] 銀河系マーカー（ドラッグ可能）
- [x] 距離円の描画（主要8銀河）
- [x] 銀河系直径の入力と縮尺計算
- [x] 描画更新機能

### Phase 2: UI/UX改善
- [x] ポップアップ表示（詳細情報）
- [x] 凡例パネル
- [x] 描画範囲外パネル
- [x] パネル折りたたみ機能
- [x] 地図スタイル切り替え

### Phase 3: 追加機能
- [ ] 銀河本体の表示（直径を円で表示）
- [ ] 全画面モード
- [ ] レスポンシブ対応の最適化

### Phase 4: 拡張機能
- [ ] アニメーション
- [ ] 比較モード
- [ ] 3D表示
- [ ] クイズモード

---

## 11. テスト項目

### 11.1 機能テスト
- [ ] 銀河系マーカーのドラッグ
- [ ] 銀河系直径の入力（正常値、異常値）
- [ ] 描画更新ボタン
- [ ] 地図スタイル切り替え
- [ ] ポップアップ表示
- [ ] 全画面モード

### 11.2 表示テスト
- [ ] すべての距離円が正しく表示されるか
- [ ] 描画範囲外の銀河が正しくリスト表示されるか
- [ ] ラベルが見やすく配置されているか
- [ ] 凡例が正しく表示されるか

### 11.3 パフォーマンステスト
- [ ] 大量の距離円を描画しても遅延がないか
- [ ] ドラッグ操作が滑らかか
- [ ] 地図スタイル切り替えがスムーズか

### 11.4 クロスブラウザテスト
- [ ] Chrome
- [ ] Firefox
- [ ] Safari
- [ ] Edge

### 11.5 デバイステスト
- [ ] デスクトップ（Windows、Mac）
- [ ] タブレット（iPad、Android）
- [ ] スマートフォン（iPhone、Android）

---

## 12. 参考資料

### 12.1 天文データソース
- NASA/IPAC Extragalactic Database (NED)
- Wikipedia（各銀河の記事）
- 国立天文台

### 12.2 技術ドキュメント
- [MapLibre GL JS Documentation](https://maplibre.org/maplibre-gl-js-docs/api/)
- [Turf.js Documentation](https://turfjs.org/docs/)
- [地理院地図タイル一覧](https://maps.gsi.go.jp/development/ichiran.html)

---

## 13. ライセンスと著作権

### 13.1 地図データ
- OpenStreetMap: © OpenStreetMap contributors
- 地理院地図: 国土地理院

### 13.2 ライブラリ
- MapLibre GL JS: BSD 3-Clause License
- Turf.js: MIT License

### 13.3 本プロジェクト
- ライセンス: MIT License（推奨）
- 著作権: プロジェクト作成者

---

## 14. 更新履歴

| 日付       | バージョン | 変更内容 |
| ---------- | ---------- | -------- |
| 2025-12-10 | 1.0.0      | 初版作成 |

---

**以上**

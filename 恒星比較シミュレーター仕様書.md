# 恒星比較シミュレーター 仕様書

## 1. 概要

太陽を基準として、他の大きな恒星の相対的なサイズを地図上で視覚化するWebアプリケーション。
MapLibre GL JSを使用し、太陽を中心に配置した際に他の恒星がどれほどの大きさになるかを実際の地図上でシミュレートする。

---

## 2. 主要機能

### 2.1 基本機能
- **太陽の直径設定**: ユーザーが太陽の直径（メートル単位）を入力
- **縮尺計算**: 入力値から縮尺係数を自動計算
- **恒星の描画**: 太陽を中心に他の恒星を縮尺に応じた円として描画
- **太陽マーカーのドラッグ**: 太陽の位置を地図上で自由に移動可能
- **背景地図の切り替え**: OpenStreetMap、地理院地図（標準/淡色/白地図/衛星写真）

### 2.2 表示情報
- 各恒星の名称ラベル
- 恒星の実際の直径（太陽直径の何倍か）
- 恒星の種類（主系列星、赤色巨星、超巨星など）
- クリック時のポップアップで詳細情報表示

### 2.3 UI要素
- **コントロールパネル**: 太陽の直径入力、地図スタイル選択
- **凡例パネル**: 恒星リストと色分け
- **範囲外パネル**: 地図の表示範囲を超える恒星の情報
- **全画面モードボタン**
- **パネル折りたたみ機能**

---

## 3. 恒星データ

### 3.1 対象恒星リスト

| 恒星名         | 直径（太陽比） | 実際の直径（km） | 色      | 種別          | 距離（光年） |
| -------------- | -------------- | ---------------- | ------- | ------------- | ------------ |
| 太陽           | 1.0            | 1,392,700        | #FFD700 | G型主系列星   | -            |
| シリウスA      | 1.7            | 2,367,590        | #87CEEB | A型主系列星   | 8.6          |
| ベガ           | 2.4            | 3,342,480        | #E0FFFF | A型主系列星   | 25           |
| アルクトゥルス | 25.4           | 35,374,580       | #FF8C00 | K型赤色巨星   | 37           |
| アルデバラン   | 44.2           | 61,557,340       | #FF6347 | K型赤色巨星   | 65           |
| リゲル         | 78.9           | 109,886,130      | #B0E0E6 | B型超巨星     | 860          |
| ポルックス     | 8.8            | 12,255,760       | #FFA07A | K型巨星       | 34           |
| カペラ         | 12.2           | 16,990,940       | #FFFFE0 | G型巨星       | 43           |
| アンタレス     | 680            | 946,236,000      | #DC143C | M型赤色超巨星 | 550          |
| ベテルギウス   | 764            | 1,063,982,800    | #FF4500 | M型赤色超巨星 | 640          |
| おおいぬ座VY星 | 1,420          | 1,977,634,000    | #8B0000 | M型極超巨星   | 3,900        |

### 3.2 データ構造
```javascript
const STARS = [
  {
    name: '太陽',
    diameterRatio: 1.0,
    diameterKm: 1392700,
    color: '#FFD700',
    type: 'G型主系列星',
    distanceLY: 0,
    isSun: true
  },
  {
    name: 'シリウスA',
    diameterRatio: 1.7,
    diameterKm: 2367590,
    color: '#87CEEB',
    type: 'A型主系列星',
    distanceLY: 8.6,
    isSun: false
  },
  // ... 以下同様
];
```

---

## 4. 縮尺計算ロジック

### 4.1 基本計算式

```
縮尺係数 = 入力された太陽の直径(m) / (太陽の実際の直径(km) × 1000)

各恒星の地図上での半径(m) = (恒星の実際の直径(km) × 1000 × 縮尺係数) / 2

各恒星の地図上での半径(km) = 各恒星の地図上での半径(m) / 1000
```

### 4.2 描画範囲制限
- 地図上での半径が **20,000 km** を超える恒星は描画範囲外として扱う
- 範囲外の恒星は「範囲外パネル」に情報を表示
- 地球の円周（約40,075 km）を基準に「地球○周分」として表示

---

## 5. 地図描画仕様

### 5.1 太陽の描画
- **マーカー**: グラデーション付き円形マーカー（30px × 30px）
- **ドラッグ可能**: ユーザーが自由に位置を変更できる
- **スタイル**: 
  - `radial-gradient(circle, #FFD700, #FFA500)`
  - 白枠（3px）
  - ボックスシャドウ（オレンジ色の光彩効果）

### 5.2 恒星の描画
- **形状**: Turf.jsの`turf.circle()`で生成した円形ポリゴン
- **塗りつぶし**: 各恒星の色で半透明（opacity: 0.7）
- **アウトライン**: 同色の線（幅: 2px、opacity: 0.9）
- **ラベル**: 恒星名を円の中心上部に配置
  - フォントサイズ: 種別によって可変（12〜24px）
  - 白いハロー効果（テキストの視認性向上）

### 5.3 レイヤー順序
1. 背景地図
2. 恒星の円（塗りつぶし）
3. 恒星のアウトライン
4. 恒星のラベル
5. 太陽マーカー（最前面）

---

## 6. インタラクション仕様

### 6.1 恒星クリック時のポップアップ
表示内容:
- 恒星名（色付き見出し）
- 実際の直径（km、太陽比）
- 恒星の種別
- 地球からの距離（光年）
- 地図上での直径（メートル）
- Google Mapsリンク（クリック位置の座標）

### 6.2 太陽の直径入力
- **自動計算**: 例示として他の恒星の直径も自動更新
- **Enterキー**: 押下で即座に描画更新
- **範囲**: 0.1m 以上（制限なし）
- **推奨値の例示**:
  - 10m → アンタレス: 約6.8km
  - 100m → ベテルギウス: 約76.4km
  - 1,000m → おおいぬ座VY星: 約1,420km

### 6.3 マウスインタラクション
- 恒星の円にマウスオーバー: カーソルがポインターに変化
- ドラッグ中の太陽マーカー: カーソルが「move」

---

## 7. UI レイアウト

### 7.1 コントロールパネル（左上）
```
🌟 恒星サイズ比較シミュレーター
[▼ 折りたたみボタン]

背景地図: [▼ ドロップダウン]

太陽の直径 (m): [      ] (入力欄)

推奨設定例:
・小さな公園規模: 10m
・街区規模: 100m
・都市規模: 1,000m

[描画更新] (ボタン)

ℹ️ 太陽マーカーをドラッグして位置を変更できます
```

### 7.2 凡例パネル（右下）
```
天体分類
[▼ 折りたたみボタン]

■ 主系列星
  ● シリウスA (1.7倍)
  ● ベガ (2.4倍)

■ 巨星
  ● アルクトゥルス (25.4倍)
  ● アルデバラン (44.2倍)
  ● ポルックス (8.8倍)
  ● カペラ (12.2倍)

■ 超巨星
  ● リゲル (78.9倍)
  ● アンタレス (680倍)
  ● ベテルギウス (764倍)

■ 極超巨星
  ● おおいぬ座VY星 (1,420倍)
```

### 7.3 範囲外パネル（右上）
```
📏 描画範囲外の恒星
[▼ 折りたたみボタン]

┃ ベテルギウス
┃ 半径: 38,200 km
┃ 地球 1.9 周分
┃ (種別: M型赤色超巨星)

┃ おおいぬ座VY星
┃ 半径: 71,000 km
┃ 地球 3.5 周分
┃ (種別: M型極超巨星)
```

### 7.4 全画面ボタン（左下）
- アイコン: ⛶（全画面化）/ ❌（終了）
- 位置: 左下固定
- スタイル: 白背景、影付き

---

## 8. 技術仕様

### 8.1 使用ライブラリ
- **MapLibre GL JS 5.0.0**: 地図描画エンジン
- **Turf.js 6.5.0**: 地理空間演算（円生成、距離計算）

### 8.2 座標系
- **EPSG:3857** (Web Mercator): MapLibre GL JSのデフォルト投影法
- 中心座標のデフォルト: `[135.2597718, 34.2161407]` (和歌山県 四季の郷公園)

### 8.3 地図スタイル
1. **OpenStreetMap** (osm)
2. **地理院地図 標準** (gsi-std)
3. **地理院地図 淡色** (gsi-pale)
4. **地理院地図 白地図** (gsi-blank)
5. **地理院地図 衛星写真** (gsi-photo)

### 8.4 描画最適化
- 円の頂点数: 64ステップ（滑らかな円形）
- レイヤーの動的追加/削除: スタイル変更時に再描画
- GeoJSONデータの保持: 再描画時の計算コスト削減

---

## 9. レスポンシブ対応

### 9.1 パネルの折りたたみ
- 全パネルに折りたたみボタンを配置
- アニメーション: `max-height` と `opacity` のトランジション（0.3秒）
- 状態保持: セッション中は折りたたみ状態を維持

### 9.2 モバイル対応（将来的な拡張）
- パネルのスタック配置
- タッチ操作対応（ドラッグ、ピンチズーム）
- フォントサイズの動的調整

---

## 10. データの正確性

### 10.1 恒星の直径データ
- 出典: 天文学的観測データ（Hipparcos、Gaia等）
- 注意: 恒星の直径は観測手法や文献により異なる場合がある
- 超巨星の直径は変動する可能性がある（脈動変光星）

### 10.2 縮尺の限界
- 地図投影法の歪み: Web Mercator投影では高緯度で歪みが大きい
- 推奨使用範囲: 緯度 ±70度以内
- 超大型恒星: 地球数周分となり、地図上での表現が困難

---

## 11. 拡張機能案

### 11.1 比較モード
- 2つの恒星を選択して直接比較
- スライダーで太陽のサイズを動的に変更

### 11.2 アニメーション
- 恒星の脈動をアニメーション表示（変光星）
- 太陽から恒星までの光の伝播をアニメーション

### 11.3 教育機能
- 恒星の進化段階の説明
- HR図（ヘルツシュプルング・ラッセル図）との連携
- クイズモード

### 11.4 データエクスポート
- スクリーンショット機能
- 縮尺データのCSVエクスポート
- SNSシェア機能

---

## 12. パフォーマンス要件

- 初回読み込み: 3秒以内
- 描画更新: 1秒以内
- 地図スタイル変更: 2秒以内
- メモリ使用量: 200MB以下（ブラウザ）

---

## 13. ブラウザ互換性

- Google Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

---

## 14. アナリティクス

- Google Analytics 4 による使用状況トラッキング
- トラッキング項目:
  - 太陽の直径設定値の分布
  - 地図スタイルの選択傾向
  - 恒星クリック数
  - セッション時間

---

## 15. ファイル構成

```
stellar-comparison-map.html    # メインHTMLファイル（単一ファイル構成）
├─ HTML構造
├─ CSS（埋め込み）
└─ JavaScript（埋め込み）
   ├─ 定数定義（恒星データ）
   ├─ 地図初期化
   ├─ 縮尺計算
   ├─ 描画ロジック
   ├─ イベントハンドラ
   └─ UI制御
```

---

## 16. 実装優先順位

### Phase 1（最小限の機能）
- ✅ 太陽マーカーの配置
- ✅ 太陽の直径入力と縮尺計算
- ✅ 主要恒星（10個程度）の描画
- ✅ 基本的なポップアップ情報

### Phase 2（標準機能）
- ✅ 全恒星の描画
- ✅ 凡例パネル
- ✅ 範囲外パネル
- ✅ 地図スタイル切り替え

### Phase 3（拡張機能）
- ⬜ パネル折りたたみアニメーション
- ⬜ 全画面モード
- ⬜ 推奨設定例の表示

### Phase 4（高度な機能）
- ⬜ 比較モード
- ⬜ アニメーション
- ⬜ データエクスポート

---

## 17. 注意事項・制限事項

1. **表示範囲の制限**: 
   - 超巨星は実際の縮尺では地図に収まらないことが多い
   - 太陽の直径を小さく設定することを推奨

2. **精度の限界**:
   - 恒星の直径は観測により変動する可能性がある
   - 地図投影法による歪みが存在する

3. **パフォーマンス**:
   - 多数の大きな円を描画するとブラウザが重くなる可能性
   - 範囲外判定により描画負荷を軽減

4. **教育目的**:
   - 本アプリは教育・啓蒙目的であり、学術研究での使用は推奨しない

---

## 18. ライセンスと著作権

- MapLibre GL JS: BSD 3-Clause License
- Turf.js: MIT License
- OpenStreetMap: ODbL (Open Database License)
- 地理院地図: 国土地理院の利用規約に準拠
- Google Analytics: Google の利用規約に準拠

---

## 19. 改版履歴

| バージョン | 日付       | 変更内容 |
| ---------- | ---------- | -------- |
| 1.0        | 2025-12-10 | 初版作成 |

---

**仕様書作成者**: GitHub Copilot  
**最終更新日**: 2025年12月10日
